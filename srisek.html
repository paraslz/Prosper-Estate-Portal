<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang Sri Sisek - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        /* Using green theme from idealestate.html */
        .dropdown-btn.active { background-color: #14532d; } 
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Sri Sisek Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            // Data updated with PA Report 2/2025 (Sept 2025)
            const estateData = {
                "id": "srisek",
                "name": "Ladang Sri Sisek",
                "reportInfo": "Data based on Agronomy Report 1/2025 (March 2025) and PA Report 2/2025 (Visit: 18th September 2025).",
                "summaryMetrics": {
                    "area": { 
                        "title": "Estate Area", 
                        "lines": [
                            "Total Planted: 315.69 ha",
                            "Mature: 263.97 ha", 
                            "Immature: 51.72 ha"
                        ]
                    },
                    "yield": { 
                        "title": "Yield/Ha (Actual vs Budget)", 
                        "value": "14.43 / 19.26 MT", 
                        "note": "YTD August 2025" 
                    },
                    "cost": { 
                        "title": "FFB Cost/Tonne", 
                        "value": "N/A", 
                        "note": "Data not available" 
                    },
                    "weeding": { 
                        "title": "Weeding Progress", 
                        "value": "Delayed", 
                        "note": "Circle Spraying 61% complete" 
                    },
                    "manuring": { 
                        "title": "Manuring Progress", 
                        "value": "On Schedule (Mature)", 
                        "note": "Slight delay in immature" 
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Ratio", "value": "1:30 ha" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Action Required" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER %", "value": "N/A" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "2.07-2.22 MT/md" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "10-36 Days (Delayed)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "Mild K & Mg Deficiency" }
                ],
                "chartData": {
                    "production": {
                        // Preserved 2024 data from previous report
                        "labels": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                        "ffb": [441, 440, 489, 535, 661, 691, 614, 688, 766, 496, 462, 327],
                        "rainfall": [443, 21, 31, 321, 444, 108, 216, 206, 254, 70, 187, 271],
                        "note": "*FFB production and rainfall data for 2024. (Source: Agronomy Report 1/2025)"
                    },
                    "ageProfile": {
                        // Updated from PA Report 2/2025
                        "labels": ["0-3 Years (15.4%)", "4-8 Years (10.1%)", "9-12 Years (11.9%)", "13-18 Years (9.3%)", ">19 Years (53.3%)"],
                        "data": [15.36, 10.11, 11.90, 9.33, 53.30],
                        "title": "Sri Sisek Palm Age Distribution (2025)",
                        "note": "*Source: PA Report 2/2025, Pg. 11."
                    }
                },
                "observations": [
                    "<b>Delayed Harvesting & Crop Loss:</b> Harvesting intervals are severely delayed, reaching 36 days (target <15), causing crop loss from overripe bunches, especially in tall palms. FFB production is 25% below budget YTD. <span class='observation-ref'>(PA Report, Pg. 30, 32, 41-42)</span>",
                    "<b>Pest & Disease Pressure:</b> Ganoderma is now a 'main issue' requiring active control (mounding, de-boling). Rat attacks exceeded the 10% threshold in Field P18G. Rhinoceros beetle attacks persist in immature areas. <span class='observation-ref'>(PA Report, Pg. 5, 23-24, 41)</span>",
                    "<b>Weeding Behind Schedule:</b> Circle spraying is delayed, with only 2 rounds (61%) completed. This impacts loose fruit collection and field upkeep. <span class='observation-ref'>(PA Report, Pg. 4, 17, 40)</span>",
                    "<b>Worker Shortage:</b> The estate is short 9 workers, directly impacting harvesting and weeding. 10 new Indonesian workers are expected in October to address this. <span class='observation-ref'>(PA Report, Pg. 15, 40)</span>",
                    "<b>Data Recording & Palm Census:</b> FFB yield recording is unreliable due to crop mix-ups. A new palm census is required to update palm density for accurate fertiliser allocation and replanting decisions. <span class='observation-ref'>(PA Report, Pg. 7, 12, 32, 40)</span>",
                    "<b>Nutrient Deficiency:</b> Mild potassium (K) and magnesium (Mg) deficiencies were previously noted and require monitoring. <span class='observation-ref'>(Agronomy Report, Pg. 16-28)</span>"
                ],
                "reports": {
                    // Preserved from srisek (1).html
                    "agronomy": { 
                        "Executive Summary": "The estate's yield increased by 20.1% in 2024. However, harvesting intervals are slightly extended, and crop recovery needs improvement. Mild nutrient deficiencies (K, Mg) are present. Rat damage and Ganoderma infection require attention. Weeding programs, particularly circle spraying, are delayed. (Agronomy Report, Pg. 4-7, 53)",
                        "Nutrient Inputs/Progress of Manuring": "The 2024 manuring program was not fully completed for RP and Compound fertilizers due to rain. The balance is carried forward. EFB application is acceptable but the application rate is below the recommended 50mt/ha. (Agronomy Report, Pg. 12-15)",
                        "Agronomic Observation": "Harvesting intervals (13-19 days) are slightly extended. Pruning is complete and acceptable. Mild potassium and magnesium deficiencies were observed. Weeding is acceptable but circle spraying is due in some areas. Rat damage was noted in several fields, and Ganoderma requires management with soil mounding and deboling. (Agronomy Report, Pg. 16-28)",
                        "Yield Performance": "Yield increased by 20.1% in 2024, in line with regional trends. Harvesting rounds were slightly below target in some fields. Key areas for improvement are manuring timeliness, updating palm census, and regular pest/disease monitoring. (Agronomy Report, Pg. 51-53)",
                        "Fertilizer Recommendation": "No amendment is made to the 2025 fertilizer program. The 2026 program will be drawn up after the next agronomy visit. (Agronomy Report, Pg. 54)"
                    },
                    // Updated from PA Report 2/2025
                    "plantation": { 
                        "Executive Summary": "Estate upkeep and cultivation were generally acceptable. However, harvesting and collection need significant improvement to maximise crop recovery. FFB production YTD (Aug 2025) is 25% below the estimate, with crop loss observed in tall palm fields due to extended harvesting intervals. Ganoderma is spreading in mature areas. (PA Report, Pg. 40-42)",
                        "Area Statement": "Total planted area is 315.69 ha (Mature: 263.97 ha, Immature: 51.72 ha). No changes since the last visit. A palm census is required to update palm density records. (PA Report, Pg. 9-12)",
                        "Labour Statement": "The estate has 13 permanent workers (1:25 ha ratio) and is short by 9 workers. Harvester ratio is 1:30 ha. 10 new foreign workers are expected in October 2025 to prioritize harvesting. (PA Report, Pg. 15)",
                        "Staff Establishment": "Staffing is satisfactory. Mr Go Kian Horng reported as the new Assistant In-Charge on 3rd September 2025, taking over from En. Zulkifly Bin Nasir. (PA Report, Pg. 13-14)",
                        "General Charges": "N/A",
                        "Upkeep and Cultivation": "Circle spraying is delayed, with 2 rounds (61%) completed. Selective spraying is also delayed. Manuring in mature areas is on schedule, but a slight delay was noted in immature fields. Roads are generally accessible but require patching. Pruning is satisfactory, but tall palms (P05L) require only dry frond removal. (PA Report, Pg. 17-28, 40)",
                        "Harvesting and Collection": "Harvesting is carried out by 9 harvesters. Intervals are extended, ranging from 10 to 36 days, well above the 15-day target. This is especially problematic in the 149 ha covered by the Indonesian gang. Harvester productivity is acceptable at 2.07-2.22 MT/day. (PA Report, Pg. 29-31, 41)",
                        "Crop Production": "YTD (Aug 2025) production is 3,855.80 MT, which is 25% below the budget of 5,147.74 MT. YTD Yield/Ha is 14.43 MT. A good fruit set is visible, and the estate has the potential to close 2025 at ~24.00 MT/ha if harvesting is improved. (PA Report, Pg. 32-33, 42)",
                        "Production Cost": "N/A",
                        "Vehicles Running Cost": "N/A",
                        "Capital Expenditure": "N/A",
                        "Immature": "Fields PR22H, PR23N, and PR221 are under or ready for scout harvesting. PR22H will be mature in Jan 2026. Rhinoceros beetle attacks continue in PR24M. Severe wild boar damage was noted in PR221. (PA Report, Pg. 34-39)"
                    },
                    // Added per idealestate.html template
                    "pinfosys": "Not Available"
                },
                "policy": "<p>No specific policy cross-references were available in the provided reports.</p>"
            };

            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Weeding') ? 'bg-yellow-50 text-yellow-800' : 'bg-purple-50 text-purple-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (2024)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#fde047', '#facc15', '#eab308', '#ca8a04', '#a16207'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);
                
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (agronomyDiv) {
                    agronomyDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }

                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (plantationDiv) {
                    plantationDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }

                if (pinfosysDiv && estateData.reports.pinfosys === "Not Available") {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const policyData = `<p>No specific policy cross-references were available in the provided reports.</p>`;
            modalTitle.innerText = 'Agricultural Policy Cross-Reference: Ladang Sri Sisek';
            modalContent.innerHTML = policyData;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
