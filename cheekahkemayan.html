<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Cheekah Kemayan Estate - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Cheekah Kemayan Estate Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "cheekahkemayan",
                "name": "Ladang Cheekah Kemayan",
                "reportInfo": "Data based on Planting Advisory Report 02/2025 (visit on 24th December 2025) & Agronomy Report 1/2025 (visit on 20th August 2025).",
                "summaryMetrics": {
                    "area": { 
                        "title": "Estate Area (Planted)", 
                        "lines": [
                            "Mature: 1,208.76 ha", 
                            "Immature: 225.37 ha", 
                            "Replanting: 109.25 ha (PR25B)", 
                            "Total: 1,543.38 ha"
                        ] 
                    },
                    "yield": { 
                        "title": "Yield/Ha (Actual / Budget)", 
                        "value": "14.30 / 16.20 MT", 
                        "note": "YTD Nov 2025 (Var: -12%)" 
                    },
                    "cost": { 
                        "title": "FFB Cost/Tonne (Actual / Budget)", 
                        "value": "RM 223.63 / RM 241.22", 
                        "note": "YTD Nov 2025 (Var: +7% Fav)" 
                    },
                    "manuring": { 
                        "title": "Manuring Progress (2025)", 
                        "value": "80% Completed", 
                        "note": "Delayed due to weather/delivery (PA Pg. 21)" 
                    },
                    "ganoderma": { 
                        "title": "Ganoderma Status", 
                        "value": "High Incidence", 
                        "note": "Major issue in tall palms; de-boling required" 
                    }
                },
                "keyMetrics": [
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>`, "label": "Labour Deficit", "value": "-2 Workers (89/91)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>`, "label": "Pests", "value": "Bagworm (30ha in P98C)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>`, "label": "Weeding Status", "value": "74% Selective Completed" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>`, "label": "Harvest Interval", "value": "14-19 Days (Needs impv.)" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636' /></svg>`, "label": "Crop Recovery", "value": "12% Below Budget" },
                    { "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>`, "label": "Palm Age Profile", "value": "Unfavourable (84% old)" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["2020", "2021", "2022", "2023", "2024", "2025(Est)"],
                        "ffb": [19.63, 14.78, 16.42, 16.63, 17.35, 16.00],
                        "note": "*Estate FFB Yield Performance (MT/Ha) 2020-2025. 2025 is estimated."
                    },
                    "ageProfile": {
                        "labels": ["0-3 Yrs (Immature)", "4-7 Yrs (Young Mature)", "8-19 Yrs (Prime)", "20-25 Yrs (Declining)", ">26 Yrs (Old)"],
                        "data": [21.7, 16.2, 0, 20.3, 41.8],
                        "title": "Cheekah Kemayan Palm Age Profile (% of Area)",
                        "note": "*Source: Agronomy Report 1/2025, Pg. 10. No palms in prime-yielding age."
                    }
                },
                "observations": [
                    "<b>Yield Performance Below Budget:</b> FFB production for 2025 is 12% below budget, largely due to poor performance in P98C, P99D, and P01E. Recovery requires ensuring contractor commitment to harvester numbers. <span class='observation-ref'>(PA Report 2/2025, Pg. 33, 49)</span>",
                    "<b>Bagworm Outbreak in P98C:</b> A 30-hectare area in Field P98C has an active Bagworm infestation. Immediate treatment is required at the appropriate larval stage to prevent spread. <span class='observation-ref'>(PA Report 2/2025, Pg. 23)</span>",
                    "<b>Delayed Field Maintenance:</b> 2025 Manuring is only 80% complete, and Selective Spraying is 74% complete. Delays are attributed to weather and labor fluctuations. Fertilizer application should resume after the rainy season. <span class='observation-ref'>(PA Report 2/2025, Pg. 19, 21)</span>",
                    "<b>High Ganoderma Incidence:</b> Ganoderma remains a critical issue in tall palm fields. De-boling of stumps must be expedited to control spread. Mortality is exceeding 5% in affected tall palm fields. <span class='observation-ref'>(PA Report 2/2025, Pg. 23-24; AR Pg. 11)</span>",
                    "<b>Sterile Palms in Young Mature (P21A):</b> Sterile palms have been observed in Field P21A. A census is required to remove these and supply productive palms to optimize density. <span class='observation-ref'>(PA Report 2/2025, Pg. 25)</span>",
                    "<b>Labour Shortage:</b> There is a deficit of 2 workers against the requirement of 91. While harvester numbers are close to sufficient, drivers and weeding gangs are short. <span class='observation-ref'>(PA Report 2/2025, Pg. 13-14)</span>"
                ],
                "reports": {
                    "plantation": { 
                        "Executive Summary": "The estate's overall performance is acceptable, although yield is currently 12% below the YTD budget. Management is focusing on resolving labour shortages in the weeding and transport divisions and addressing a bagworm outbreak in P98C. Replanting activities in PR25B are proceeding on schedule. The cost of production remains well-controlled at RM 223.63/MT, which is 7% below the budget ceiling. (PA Report, Pg. 48-50)",
                        "Area Statement": "As of Nov 2025, the total planted area is <b>1,543.38 ha</b>. This comprises: <br>• <b>Mature:</b> 1,208.76 ha (78%)<br>• <b>Immature:</b> 225.37 ha (15%)<br>• <b>Replanting:</b> 109.25 ha (7%)<br>Note: Mature area reduced due to replanting of P97B and part of P98C. (PA Report, Pg. 10)",
                        "Labour Statement": "Current workforce is 89 workers vs. a requirement of 91 (-2 deficit). <br>• <b>Harvesters:</b> 49 (Req: 49) - Sufficient.<br>• <b>Drivers/Loaders:</b> 5 (Req: 8) - Deficit of 3.<br>• <b>Weeding:</b> 12 (Req: 15) - Deficit of 3.<br>• <b>Manuring:</b> 5 (Req: 6) - Deficit of 1.<br>The worker-to-land ratio is 1:17 ha, which is tight for high-maintenance periods. (PA Report, Pg. 13-14)",
                        "Staff Establishment": "The staff establishment is satisfactory with 13 personnel. The estate has 7 Field Conductors (ratio 1:220 ha), which is considered sufficient for effective supervision. En. Norrafiuddin (Manager) and En. Mohamad Afif Aizat (Jr. Asst Manager) were transferred to the estate in late 2025. (PA Report, Pg. 12)",
                        "General Charges": "Total General Charges are <b>RM 993.59/ha</b>, which is 25% below the budget of RM 1,324.50. <br>• <b>Overspending:</b> 'Staff Salaries' (+23% due to headcount/pay variances) and 'Office Expenses' (+72% due to painting). <br>• <b>Savings:</b> Significant savings in recruitment and other administrative costs offset the overspending. (PA Report, Pg. 16-17)",
                        "Upkeep and Cultivation": "• <b>Weeding:</b> Circle spraying is 89% complete; Selective spraying is 74% complete (delayed). Cost is RM 169.76/ha (18% below budget).<br>• <b>Manuring:</b> 80% complete (749.55 MT applied). Delayed due to weather and delivery issues. Cost is RM 744.05/ha (12% below budget).<br>• <b>Pest & Disease:</b> Generally under control, but Bagworm infestation in P98C (30 ha) requires immediate attention. (PA Report, Pg. 18-30)",
                        "Harvesting and Collection": "YTD Cost is <b>RM 76.18/MT</b>, slightly higher (8%) than the budget of RM 70.76. <br>• <b>Interval:</b> Ranging from 14 to 19 days. Target is to strictly maintain <15 days.<br>• <b>Mechanization:</b> 10 Mechanical Buffaloes are assisting 49 harvesters.<br>• <b>Quality:</b> Generally acceptable, though monitoring for long stalks and overripe bunches is needed. (PA Report, Pg. 31, 45)",
                        "Crop Production": "YTD (Nov) FFB Production is <b>16,445 MT</b>, which is 12% below the budget of 18,629 MT. <br>• <b>Yield/Ha:</b> 14.30 MT/ha (YTD). <br>• <b>Underperforming Fields:</b> P98C, P99D, and P01E showed yield reductions compared to estimates. <br>• <b>Forecast:</b> Estate expected to close 2025 with ~16.00 MT/ha. (PA Report, Pg. 33)",
                        "Production Cost": "YTD Cost of Production is <b>RM 223.63/MT</b>, which is 7% favorable compared to the budget of RM 241.22/MT. <br>• <b>General Charges:</b> RM 93.09/MT (-18%)<br>• <b>Upkeep:</b> RM 74.70/MT (-9%)<br>• <b>Harvesting:</b> RM 76.18/MT (+8%) (PA Report, Pg. 34)",
                        "Vehicles Running Cost": "Vehicles are in good condition except for the Tractor Landini which has broken down. The estate has been advised to implement a vehicle running recording system to better monitor utilization and expenses. (PA Report, Pg. 47)",
                        "Capital Expenditure": "N/A (Costs largely captured under Replanting and Immature upkeep headers).",
                        "Immature": "• <b>P23B (74.80 ha):</b> 24 months old. Growth is uniform/satisfactory. Cost to maturity: RM 12,622/ha.<br>• <b>P24B (150.57 ha):</b> 12 months old. Upkeep is slightly delayed. Cost to maturity: RM 7,634/ha.<br>• <b>Replanting PR25B (109.25 ha):</b> Land preparation (bunds, drains, roads) is complete. Planting is in progress (Nov-Jan). Cost from start: RM 3,161/ha. (PA Report, Pg. 35-40)"
                    },
                    "agronomy": { 
                        "Executive Summary": "The visit on 20th August 2025 focused on identifying yield-limiting factors. Key findings include an unfavorable palm age profile (84% old/declining yield), significant crop losses from poor harvesting standards, high Ganoderma incidence, low palm density, and poor nursery conditions. Yield for 2025 is trending lower than in 2024. Corrective actions are required to address these critical issues. (Source: AR, Pg. 8, 59-64)",
                        "Nutrient Inputs/Progress of Manuring": "The 2024 manuring program was completed in Jan 2025 after delays. The 2025 program is 66% complete as of July, but with delays in RP and Compound application. Quality of application needs improvement, as lumping and placement too close to palm bases were observed. (Source: AR, Pg. 24-27)",
                        "Agronomic Observation": "Harvesting quality is acceptable, but severe crop losses from uncollected bunches and loose fruits were noted. Pruning is satisfactory, but many palms have small canopies due to Ganoderma. Ground vegetation is manageable but needs better supervision to ensure complete kill. Ganoderma is the most significant disease. Rat damage is under control. (Source: AR, Pg. 33-48)",
                        "Yield Performance": "The 2024 yield was 17.35 MT/ha. However, the yield for Jan-July 2025 (9.13 MT/ha) is lower than the same period in 2024 (11.07 MT/ha). Major limiting factors are the unfavorable age profile, high crop losses, declining palm density, and severe Ganoderma infection. (Source: AR, Pg. 59-63)",
                        "Fertilizer Recommendation": "The 2025 fertilizer program remains unchanged. However, an additional 1.5 kg/palm of Ammonium Sulfate (AS) is recommended for application in October 2025 for specific blocks to compensate for the cessation of ECOFERT liquid fertilizer. (Source: AR, Pg. 65)"
                    },
                    "pinfosys": {
                        "CEO Financial Summary": "N/A",
                        "Summary of Oil Palm Expenditure": "N/A"
                    }
                },
                "policy": "<div class='policy-item'><p class='font-semibold'>Bagworm Control</p><p class='text-sm text-gray-600'><b>Policy Area:</b> Immediate census and treatment (trunk injection or spraying) required when infestation exceeds economic threshold. Beneficial plants (Cassia, Antigonon) should be planted.</p></div> <div class='policy-item'><p class='font-semibold'>Ganoderma Management</p><p class='text-sm text-gray-600'><b>Policy Area:</b> Strict sanitation (de-boling) of infected stands is mandatory. No mounding for palms >20 years old.</p></div> <div class='policy-item'><p class='font-semibold'>Manuring Schedule</p><p class='text-sm text-gray-600'><b>Policy Area:</b> Fertilizer application must be timed to avoid heavy rainfall periods to prevent surface runoff and leaching.</p></div>"
            };

            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate();
                    populateInternalDropdowns();
                    attachEventListeners();
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Ganoderma') ? 'bg-red-50 text-red-800' : 'bg-purple-50 text-purple-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">FFB Performance (2020-2025)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'line',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [{ 
                                label: 'FFB Yield (MT/Ha)', 
                                data: estateData.chartData.production.ffb, 
                                borderColor: '#166534',
                                backgroundColor: 'rgba(22, 101, 52, 0.1)',
                                fill: true,
                                tension: 0.1 
                            }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: false, title: { display: true, text: 'MT/Ha' } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ 
                                data: estateData.chartData.ageProfile.data, 
                                backgroundColor: ['#fde047', '#facc15', '#a3a3a3', '#ca8a04', '#a16207'], 
                                hoverOffset: 4 
                            }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);

                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (agronomyDiv) {
                     agronomyDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }
                
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (plantationDiv) {
                     plantationDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }
                
                 if (pinfosysDiv) {
                     // Check if pinfosys reports exist and have meaningful content
                    if(estateData.reports.pinfosys && Object.values(estateData.reports.pinfosys).some(val => val !== "N/A")) {
                        pinfosysDiv.innerHTML = Object.entries(estateData.reports.pinfosys).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                    } else {
                        pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                    }
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        const allContents = container.querySelectorAll('.details-content');
                        const allButtons = container.querySelectorAll('.dropdown-btn');
                        
                        // If clicking the already active one, just close it.
                        if (content.classList.contains('active')) {
                             content.classList.remove('active');
                             event.currentTarget.classList.remove('active');
                             return;
                        }

                        // Close all other dropdowns
                        allContents.forEach(c => { if(c !== content) c.classList.remove('active'); });
                        allButtons.forEach(b => { if(b !== event.currentTarget) b.classList.remove('active'); });

                        // Toggle the clicked one
                        content.classList.add('active');
                        event.currentTarget.classList.add('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modal = document.getElementById('policyModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const policyData = `
                <div class='policy-item'>
                    <p class='font-semibold'>Bagworm Control</p>
                    <p class='text-sm text-gray-600'><b>Policy Area:</b> Immediate census and treatment (trunk injection or spraying) required when infestation exceeds economic threshold. Beneficial plants (Cassia, Antigonon) should be planted.</p>
                </div>
                <div class='policy-item'>
                    <p class='font-semibold'>Ganoderma Management</p>
                    <p class='text-sm text-gray-600'><b>Policy Area:</b> Strict sanitation (de-boling) of infected stands is mandatory. No mounding for palms >20 years old.</p>
                </div>
                 <div class='policy-item'>
                    <p class='font-semibold'>Manuring Schedule</p>
                    <p class='text-sm text-gray-600'><b>Policy Area:</b> Fertilizer application must be timed to avoid heavy rainfall periods to prevent surface runoff and leaching.</p>
                </div>
                 <div class='policy-item'>
                    <p class='font-semibold'>Crop Recovery & Harvesting</p>
                    <p class='text-sm text-gray-600'><b>Policy Area:</b> Standards for loose fruit collection and minimising field losses must be strictly enforced to maximise yield.</p>
                </div>
                 <div class='policy-item'>
                    <p class='font-semibold'>Nursery Management</p>
                    <p class='text-sm text-gray-600'><b>Policy Area:</b> Soil media used in polybags must meet quality standards for good infiltration and root development.</p>
                </div>
            `;
            modalTitle.innerText = `Agricultural Policy Areas: Ladang Cheekah Kemayan`;
            modalContent.innerHTML = policyData;
            modal.classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
