<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Nuklias 6 Estate - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; } /* Dark green for active */
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Nuklias 6 Estate Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "nuklias",
                "name": "Nuklias 6 Estate",
                "reportInfo": "Data based on Plantation Advisory Report (Kema & Timur) 02/2025 (Visit: Sep 2025) & Agronomy Report 1/2025.",
                "summaryMetrics": {
                    "area": { 
                        "title": "Estate Area", 
                        "lines": ["Mature: 824.50 ha", "Unplanted: 17.39 ha", "Total: 841.89 ha"],
                    },
                    "yield": { 
                        "title": "Yield/Ha (Actual vs Budget)", 
                        "value": "16.21 / 17.02 MT", 
                        "note": "YTD Aug 2025" 
                    },
                    "cost": { 
                        "title": "FFB Cost/Tonne (Actual vs Budget)", 
                        "value": "RM 231.40 / RM 242.98", 
                        "note": "YTD Aug 2025" 
                    },
                    "weeding": { 
                        "title": "Weeding Progress", 
                        "value": "Acceptable", 
                        "note": "On schedule, ~1.5-2.0 rounds done" 
                    },
                    "manuring": { 
                        "title": "Manuring Progress", 
                        "value": "Satisfactory", 
                        "note": "Kema 96% done, Timur H1 100% done" 
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1:16.5 ha", "note": "Shortfall of 8 workers" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Action Required (Rats/Ganoderma)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (YTD)", "value": "18.77%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "Variable (Some low)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "< 16 days (Satisfactory)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "Mild K Deficiency" }
                ],
                "chartData": {
                    // Preserved data from original file
                    "production": {
                        "labels": ["Jan-24", "Feb-24", "Mar-24", "Apr-24", "May-24", "Jun-24", "Jul-24", "Aug-24", "Sep-24", "Oct-24", "Nov-24", "Dec-24"],
                        "ffb": [829.38, 834.24, 881.79, 805.01, 855.36, 806.79, 703.81, 842.19, 838.75, 954.52, 776.29, 822.18],
                        "rainfall": [348, 26, 68, 129, 222, 195, 126, 203, 127, 236, 321, 314],
                        "note": "*FFB production data is for Kema Division (Full Year 2024)."
                    },
                    // Preserved data from original file
                    "ageProfile": {
                        "labels": ["8-19 Years", "20-25 Years", ">25 Years"],
                        "data": [37, 51, 12],
                        "title": "Nuklias Estate Palm Age Distribution",
                        "note": "*Age distribution by hectares."
                    }
                },
                "observations": [
                    "<b>Road & Drain Work Delayed:</b> Road grading and drain desilting are behind schedule across the estate, despite being budgeted. <span class='observation-ref'>(PA Kema Pg 28/30, PA Timur Pg 28/29)</span>",
                    "<b>Ganoderma Census Overdue:</b> The recommended Ganoderma census has not been conducted for either division to assess severity. <span class='observation-ref'>(PA Kema Pg 26, PA Timur Pg 26)</span>",
                    "<b>Harvester Shortfall & Low Productivity:</b> The estate is short 7 harvesters (5 in Kema, 2 in Timur). Productivity in some fields (e.g., P08G, P02B3) is low, with earnings below minimum wage. <span class='observation-ref'>(PA Kema Pg 12/34, PA Timur Pg 13/34)</span>",
                    "<b>Rat Infestation (Kema):</b> High rat infestation was previously noted (Agro Pg 30-32). One round of baiting has since been completed in Kema, which appears effective. <span class='observation-ref'>(PA Kema Pg 25)</span>",
                    "<b>Elephant Attack Signs:</b> Signs of elephant attack were observed in P18H, with risk of damage to young shoots/spears. <span class='observation-ref'>(Agronomy Report, Pg. 37)</span>",
                    "<b>Weeding (Timur):</b> Selective weeding in Timur division is delayed due to an insufficient number of sprayers. <span class='observation-ref'>(PA Timur Pg 20)</span>"
                ],
                "reports": {
                    // Preserved data from original file
                    "agronomy": { 
                        "Executive Summary": "Nuklias 6 Estate's agronomic conditions are acceptable. Manuring and weeding programs are on schedule. Rat infestation in Kema division requires baiting, and barn owl occupancy is below expectations. Mild potassium deficiency symptoms are observed. Yields declined in early 2025 due to seasonal factors. (Agronomy Report, Pg. 4-6, 40-41)",
                        "Nutrient Inputs/Progress of Manuring": "Manuring program for 2024 was 100% completed for both divisions. For 2025 (Jan-Apr), Timur is 33% complete and Kema is 37% complete. Fertilizer deliveries are on schedule, and sampling is conducted. Application quality is acceptable. Workers use buckets, but wheelbarrows are encouraged for better productivity. (Agronomy Report, Pg. 10-15)",
                        "Agronomic Observation": "Harvesting intervals are consistently maintained within 20 days. Crop recovery is acceptable with minimal losses. Palm appearance is acceptable, but mild potassium deficiency symptoms are observed in some blocks. Weed control is satisfactory. Rat infestation exceeded 10% in Kema division, but no baiting was conducted. Barn owl occupancy is below expectations. Ganoderma infection is negligible. Elephant attack signs are observed in P18H. (Agronomy Report, Pg. 16-37)",
                        "Yield Performance": "The yield recorded in 2024 increased by ~24% compared to the previous year. The yield for the first four months of 2025 was lower than the same period last year, likely due to seasonal factors. Crop recovery was satisfactory. (Agronomy Report, Pg. 38-39)",
                        "Fertilizer Recommendation": "No amendments to the 2025 fertilizer program. The 2026 program will be drafted after the next field inspection. The estate should conduct a GPS palm census. (Agronomy Report, Pg. 40)"
                    },
                    // Updated data from new PA Reports 02/2025
                    "plantation": { 
                        "Executive Summary": "Overall estate performance is satisfactory. Crop production is slightly below budget (Kema -4%, Timur -6% YTD Aug 2025). Costs are well-controlled and below budget. Weeding and manuring are on schedule, but major upkeep like road grading and drain desilting are delayed across the estate. A harvester shortfall of 7 workers is noted. (PA Kema Pg 40-41, PA Timur Pg 40-41)",
                        "Area Statement": "Total planted area is 824.50 ha, all mature, split between Kema Division (412.70 ha) and Timur Division (411.80 ha). No replanting is planned for next year as yields from older palms (P98E, P98A) are still satisfactory. (PA Kema Pg 9-10, PA Timur Pg 10-11)",
                        "Labour Statement": "Total of 50 workers (Kema 24, Timur 26), giving a ratio of 1:16.5 ha. This is a shortfall of 8 workers. Harvester strength is 33 (Kema 15, Timur 18), a shortfall of 7. (PA Kema Pg 12, PA Timur Pg 13-14)",
                        "Staff Establishment": "The staff establishment for both divisions is considered satisfactory. (PA Kema Pg 11, PA Timur Pg 12)",
                        "General Charges": "Expenditure is well-controlled. Kema is 16% below budget (RM 862.00/ha). Timur (Accent) is 24% below budget (RM 807.85/ha) and Timur (Promvest) is 7% below budget (RM 448.18/ha). (PA Kema Pg 14, PA Timur Pg 15-16)",
                        "Upkeep and Cultivation": "Weeding and manuring are on schedule. Circle spraying is ~1.6 rounds complete; selective spraying is ~2.0 rounds (Kema) and ~1.35 rounds (Timur). Manuring is 96% complete (Kema) and 100% for H1 (Timur). Road grading and drain desilting are delayed. Ganoderma census is outstanding. (PA Kema Pg 15-32, PA Timur Pg 17-31)",
                        "Harvesting and Collection": "Progress is satisfactory, with 16 rounds completed YTD (Aug 2025) and intervals below 16 days. Harvester productivity is low in some fields (P08G, P02B3). (PA Kema Pg 34-35, PA Timur Pg 33-34)",
                        "Crop Production": "YTD (Aug 2025) FFB is 13,367.12 MT (Kema 6,847.20; Timur 6,519.92). This is below the combined budget of 14,029.99 MT. YTD yield is 16.21 T/ha (Kema 16.59; Timur 15.83). (PA Kema Pg 37, PA Timur Pg 37)",
                        "Production Cost": "YTD (Aug 2025) cost/tonne is RM 231.40 (weighted avg). Kema: RM 237.58/MT (5% below budget). Timur: RM 224.81/MT (4% below budget). Costs are satisfactory. (PA Kema Pg 38, PA Timur Pg 38)",
                        "Vehicles Running Cost": "N/A (PA Kema Pg 39, PA Timur Pg 39)",
                        "Capital Expenditure": "N/A",
                        "Immature": "N/A (Estate is fully mature)"
                    },
                    "pinfosys": {
                        "CEO Financial Summary": "N/A",
                        "Summary of Oil Palm Expenditure": "N/A"
                    }
                },
                // Preserved data from original file
                "policy": "<p>No specific policy cross-references were available in the provided reports.</p>"
            };

            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Weeding') ? 'bg-yellow-50 text-yellow-800' : 'bg-purple-50 text-purple-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p>${metric.note ? `<p class="text-xs text-gray-500">${metric.note}</p>` : ''}</div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        
                        <!-- Summary Cards -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        
                        <!-- Key Metrics -->
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        
                        <!-- Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (2024)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        
                        <!-- Key Observations -->
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        
                        <!-- Policy Button -->
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        
                        <!-- Dropdowns -->
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details (PA 02/2025)</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details (Agro 1/2025)</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#4CAF50', '#2196F3', '#FFC107', '#F44336', '#9C27B0'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);
                
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (agronomyDiv) {
                    agronomyDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }

                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (plantationDiv) {
                    plantationDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }

                if (pinfosysDiv && estateData.reports.pinfosys) {
                    pinfosysDiv.innerHTML = Object.entries(estateData.reports.pinfosys).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                } else if (pinfosysDiv) {
                     pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            // --- INITIALIZE ---
            renderEstate();
        });
        
        // --- MODAL FUNCTIONS ---
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            // This data is dynamically pulled from the estateData object
            const policyData = {"id":"nuklias","name":"Nuklias 6 Estate","reportInfo":"Data based on Plantation Advisory Report (Kema & Timur) 02/2025 (Visit: Sep 2025) & Agronomy Report 1/2025.","summaryMetrics":{"area":{"title":"Estate Area","lines":["Mature: 824.50 ha","Unplanted: 17.39 ha","Total: 841.89 ha"]},"yield":{"title":"Yield/Ha (Actual vs Budget)","value":"16.21 / 17.02 MT","note":"YTD Aug 2025"},"cost":{"title":"FFB Cost/Tonne (Actual vs Budget)","value":"RM 231.40 / RM 242.98","note":"YTD Aug 2025"},"weeding":{"title":"Weeding Progress","value":"Acceptable","note":"On schedule, ~1.5-2.0 rounds done"},"manuring":{"title":"Manuring Progress","value":"Satisfactory","note":"Kema 96% done, Timur H1 100% done"}},"keyMetrics":[{"icon":"<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>","label":"Labour Ratio","value":"1:16.5 ha","note":"Shortfall of 8 workers"},{"icon":"<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>","label":"P&D Status","value":"Action Required (Rats/Ganoderma)"},{"icon":"<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>","label":"OER % (YTD)","value":"18.77%"},{"icon":"<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>","label":"Harvester Prod.","value":"Variable (Some low)"},{"icon":"<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>","label":"Harvest Interval","value":"< 16 days (Satisfactory)"},{"icon":"<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>","label":"Nutrient Status","value":"Mild K Deficiency"}],"chartData":{"production":{"labels":["Jan-24","Feb-24","Mar-24","Apr-24","May-24","Jun-24","Jul-24","Aug-24","Sep-24","Oct-24","Nov-24","Dec-24"],"ffb":[829.38,834.24,881.79,805.01,855.36,806.79,703.81,842.19,838.75,954.52,776.29,822.18],"rainfall":[348,26,68,129,222,195,126,203,127,236,321,314],"note":"*FFB production data is for Kema Division (Full Year 2024)."},"ageProfile":{"labels":["8-19 Years","20-25 Years",">25 Years"],"data":[37,51,12],"title":"Nuklias Estate Palm Age Distribution","note":"*Age distribution by hectares."}},"observations":["<b>Road & Drain Work Delayed:</b> Road grading and drain desilting are behind schedule across the estate, despite being budgeted. <span class='observation-ref'>(PA Kema Pg 28/30, PA Timur Pg 28/29)</span>","<b>Ganoderma Census Overdue:</b> The recommended Ganoderma census has not been conducted for either division to assess severity. <span class='observation-ref'>(PA Kema Pg 26, PA Timur Pg 26)</span>","<b>Harvester Shortfall & Low Productivity:</b> The estate is short 7 harvesters (5 in Kema, 2 in Timur). Productivity in some fields (e.g., P08G, P02B3) is low, with earnings below minimum wage. <span class='observation-ref'>(PA Kema Pg 12/34, PA Timur Pg 13/34)</span>","<b>Rat Infestation (Kema):</b> High rat infestation was previously noted (Agro Pg 30-32). One round of baiting has since been completed in Kema, which appears effective. <span class='observation-ref'>(PA Kema Pg 25)</span>","<b>Elephant Attack Signs:</b> Signs of elephant attack were observed in P18H, with risk of damage to young shoots/spears. <span class='observation-ref'>(Agronomy Report, Pg. 37)</span>","<b>Weeding (Timur):</b> Selective weeding in Timur division is delayed due to an insufficient number of sprayers. <span class='observation-ref'>(PA Timur Pg 20)</span>"],"reports":{"agronomy":{"Executive Summary":"Nuklias 6 Estate's agronomic conditions are acceptable. Manuring and weeding programs are on schedule. Rat infestation in Kema division requires baiting, and barn owl occupancy is below expectations. Mild potassium deficiency symptoms are observed. Yields declined in early 2025 due to seasonal factors. (Agronomy Report, Pg. 4-6, 40-41)","Nutrient Inputs/Progress of Manuring":"Manuring program for 2024 was 100% completed for both divisions. For 2025 (Jan-Apr), Timur is 33% complete and Kema is 37% complete. Fertilizer deliveries are on schedule, and sampling is conducted. Application quality is acceptable. Workers use buckets, but wheelbarrows are encouraged for better productivity. (Agronomy Report, Pg. 10-15)","Agronomic Observation":"Harvesting intervals are consistently maintained within 20 days. Crop recovery is acceptable with minimal losses. Palm appearance is acceptable, but mild potassium deficiency symptoms are observed in some blocks. Weed control is satisfactory. Rat infestation exceeded 10% in Kema division, but no baiting was conducted. Barn owl occupancy is below expectations. Ganoderma infection is negligible. Elephant attack signs are observed in P18H. (Agronomy Report, Pg. 16-37)","Yield Performance":"The yield recorded in 2024 increased by ~24% compared to the previous year. The yield for the first four months of 2025 was lower than the same period last year, likely due to seasonal factors. Crop recovery was satisfactory. (Agronomy Report, Pg. 38-39)","Fertilizer Recommendation":"No amendments to the 2025 fertilizer program. The 2026 program will be drafted after the next field inspection. The estate should conduct a GPS palm census. (Agronomy Report, Pg. 40)"},"plantation":{"Executive Summary":"Overall estate performance is satisfactory. Crop production is slightly below budget (Kema -4%, Timur -6% YTD Aug 2025). Costs are well-controlled and below budget. Weeding and manuring are on schedule, but major upkeep like road grading and drain desilting are delayed across the estate. A harvester shortfall of 7 workers is noted. (PA Kema Pg 40-41, PA Timur Pg 40-41)","Area Statement":"Total planted area is 824.50 ha, all mature, split between Kema Division (412.70 ha) and Timur Division (411.80 ha). No replanting is planned for next year as yields from older palms (P98E, P98A) are still satisfactory. (PA Kema Pg 9-10, PA Timur Pg 10-11)","Labour Statement":"Total of 50 workers (Kema 24, Timur 26), giving a ratio of 1:16.5 ha. This is a shortfall of 8 workers. Harvester strength is 33 (Kema 15, Timur 18), a shortfall of 7. (PA Kema Pg 12, PA Timur Pg 13-14)","Staff Establishment":"The staff establishment for both divisions is considered satisfactory. (PA Kema Pg 11, PA Timur Pg 12)","General Charges":"Expenditure is well-controlled. Kema is 16% below budget (RM 862.00/ha). Timur (Accent) is 24% below budget (RM 807.85/ha) and Timur (Promvest) is 7% below budget (RM 448.18/ha). (PA Kema Pg 14, PA Timur Pg 15-16)","Upkeep and Cultivation":"Weeding and manuring are on schedule. Circle spraying is ~1.6 rounds complete; selective spraying is ~2.0 rounds (Kema) and ~1.35 rounds (Timur). Manuring is 96% complete (Kema) and 100% for H1 (Timur). Road grading and drain desilting are delayed. Ganoderma census is outstanding. (PA Kema Pg 15-32, PA Timur Pg 17-31)","Harvesting and Collection":"Progress is satisfactory, with 16 rounds completed YTD (Aug 2025) and intervals below 16 days. Harvester productivity is low in some fields (P08G, P02B3). (PA Kema Pg 34-35, PA Timur Pg 33-34)","Crop Production":"YTD (Aug 2025) FFB is 13,367.12 MT (Kema 6,847.20; Timur 6,519.92). This is below the combined budget of 14,029.99 MT. YTD yield is 16.21 T/ha (Kema 16.59; Timur 15.83). (PA Kema Pg 37, PA Timur Pg 37)","Production Cost":"YTD (Aug 2025) cost/tonne is RM 231.40 (weighted avg). Kema: RM 237.58/MT (5% below budget). Timur: RM 224.81/MT (4% below budget). Costs are satisfactory. (PA Kema Pg 38, PA Timur Pg 38)","Vehicles Running Cost":"N/A (PA Kema Pg 39, PA Timur Pg 39)","Capital Expenditure":"N/A","Immature":"N/A (Estate is fully mature)"},"pinfosys":{"CEO Financial Summary":"N/A","Summary of Oil Palm Expenditure":"N/A"}},"policy":"<p>No specific policy cross-references were available in the provided reports.</p>"}.policy;
            modalTitle.innerText = `Agricultural Policy Cross-Reference: Nuklias 6 Estate`;
            modalContent.innerHTML = policyData;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
