<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ladang Sungai Beranang - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #4a5568; }
        .policy-item { border-left: 3px solid #6366f1; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Sungai Beranang Report
                </a>
            </div>
            <a href="estates.html" class="text-indigo-600 hover:text-indigo-800 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <div class="container mx-auto p-4 md:p-8">
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             </div>
    </div>
    
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "sungaiberanang",
                "name": "Ladang Sungai Beranang",
                "reportInfo": "Data based on Agronomy Report 1/2025 (July 2025) and Planting Advisory Report 2/2025 (September 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 324.88 ha",
                            "Mature: 270.53 ha",
                            "Immature: 54.35 ha",
                            "Replanting: 78.51 ha (in 2026)"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (Actual vs Budget)",
                        "value": "12.09 / 14.70 MT",
                        "note": "YTD as of Aug 2025"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (Actual vs Budget)",
                        "value": "N/A / N/A",
                        "note": "Ex-Estate, Data not available"
                    },
                    "weeding": {
                        "title": "Weeding Progress",
                        "value": "Unsatisfactory",
                        "note": "Low sprayer productivity"
                    },
                    "manuring": {
                        "title": "Manuring Progress (2025)",
                        "value": "Behind Schedule",
                        "note": "Agronomy report notes delays"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-gray-500' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656-.126-1.283-.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Shortage", "value": "Ratio 1:23 ha", "note": "(Short 7 Harvesters)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-gray-500' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Ganoderma Detected", "note": "Census required" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-gray-500' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (YTD Aug '25)", "value": "N/A" , "note": ""},
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-gray-500' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 17h8m0 0V9m0 8l-8-8-4 4-6-6' /></svg>", "label": "Harvester Prod.", "value": "Low (<1.6 MT/md)", "note": "In older blocks" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-gray-500' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "16-18 Days", "note": "(Acceptable)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-gray-500' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4' /></svg>", "label": "Drainage", "value": "De-silting Delayed", "note": "Budgeted but not done" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["P97A", "P99B", "P01C", "P04D", "P05E", "P13F", "P18G1", "P18G2", "P18G3"],
                        "ytd2025": [8.29, 8.12, 14.31, 14.67, 13.35, 7.94, 18.27, 17.25, 16.77],
                        "ytd2024": [10.37, 10.22, 21.35, 17.39, 19.82, 8.35, 15.59, 13.69, 12.96],
                        "note": "*FFB Yield (t/ha) Comparison YTD August 2024 vs 2025."
                    },
                    "ageProfile": {
                        "labels": ["0-3 Yrs", "4-7 Yrs", "8-19 Yrs", "20-25 Yrs", ">26 Yrs"],
                        "data": [8.5, 30.6, 4.4, 32.4, 24.2],
                        "title": "Sg. Beranang Oil Palm Age Profile (2025)",
                        "note": "*Age distribution by percentage of hectares."
                    }
                },
                "observations": [
                    "<b>Critical Labour Shortage:</b> The estate is short of 7 harvesters (37%) and has shortages for manuring and spraying gangs. This directly impacts crop production and field upkeep, causing crop loss and delays. <span class='observation-ref'>(PA Report, Pg. 11, 53)</span>",
                    "<b>Low Sprayer Productivity:</b> Both circle and selective spraying productivity are low (3.4 ha/md and 3.2 ha/md respectively), with workers earning below the basic wage. This leads to delays and grassy field conditions in some blocks. <span class='observation-ref'>(PA Report, Pg. 14, 17)</span>",
                    "<b>Delayed Pruning:</b> Progressive pruning is significantly behind schedule (46% complete) due to the harvester shortage, with notable delays in blocks P05/E and P04/D. <span class='observation-ref'>(PA Report, Pg. 34-36)</span>",
                    "<b>Yield Decline Due to Labour Issues:</b> Year-to-date yield is down 17% compared to the same period in 2024, a shortfall attributed primarily to the lack of harvesters and consequently fewer harvesting rounds. <span class='observation-ref'>(PA Report, Pg. 37)</span>",
                    "<b>Ganoderma Detected:</b> Ganoderma has been found in blocks P01/C and P05/E. A census and de-boling of collapsed palms are required for monitoring and control. <span class='observation-ref'>(PA Report, Pg. 31)</span>",
                    "<b>Road Maintenance Behind Schedule:</b> Only 16% of the budgeted road grading has been completed as the contractor absconded due to low rates. Poor road conditions persist in hilly sections. <span class='observation-ref'>(PA Report, Pg. 32)</span>"
                ],
                "reports": {
                    "agronomy": { 
                        "Executive Summary": "Overall agronomic condition has deteriorated, marked by delays in key operations like manuring, weeding, and pruning. A significant issue is the acute shortage of harvesters, leading to incomplete crop recovery and extended harvesting intervals. Yield as of June 2025 is significantly lower than the previous year. Urgent attention is needed to address the worker shortage. (Agronomy Report, Pg. 58-59)",
                        "Nutrient Inputs/Progress of Manuring": "Manuring in 2024 was completed with delays. As of June 2025, the program is only 50% complete and has fallen behind schedule, particularly for Mixture B, Rock Phosphate, and compound applications in various blocks. (Agronomy Report, Pg. 12-14)",
                        "Agronomic Observation": "Crop recovery is a major issue in older plantings (P97, P99, P13) due to difficult terrain, under-pruning, and poor roads. Harvesting intervals have exceeded 20 days in some areas. Pruning and weeding are also behind schedule. Palm vigor in P13 is poor. Pest and disease levels are currently insignificant. (Agronomy Report, Pg. 15-31)",
                        "Yield Performance": "Yield in 2024 was satisfactory at 20.40 mt/ha. However, yield as of June 2025 has declined by 20.8% compared to the same period in 2024. This is attributed to unsatisfactory crop recovery due to a shortage of harvesters. (Agronomy Report, Pg. 55-58)",
                        "Fertilizer Recommendation": "No amendments are deemed necessary for the 2025 fertilizer program. (Agronomy Report, Pg. 60)"
                    },
                    "plantation": { 
                        "Executive Summary": "The estate faces a critical shortage of harvesters and general workers, which has resulted in crop loss and delays in field upkeep. Worker productivity for spraying is low and needs improvement. Key priorities are to expedite worker recruitment, complete the manuring program, and catch up on delayed pruning and road maintenance. (PA Report, Pg. 53-54)",
                        "Area Statement": "Total oil palm area stands at 324.88 ha, comprising 270.53 ha mature and 54.35 ha immature. Blocks P97/A and P99/B (78.51 ha) are scheduled for replanting in 2026. (PA Report, Pg. 9-10)",
                        "Labour Statement": "The estate is short of 7 harvesters (1:23 ha vs requirement of 1:15 ha). There are also shortages of 2 manurers and 4 sprayers. The high worker turnover is a major concern affecting all field operations. (PA Report, Pg. 11)",
                        "Staff Establishment": "The staff complement is adequate, with a new Junior Assistant Manager transferred in April 2025. (PA Report, Pg. 13)",
                        "General Charges": "N/A",
                        "Upkeep & Cultivation": "Circle spraying is 69% complete, but productivity is low at 3.4 ha/md. Selective spraying is 74% complete, with low productivity of 3.2 ha/md. Abundant VOPs were noted, and the estate is advised to focus on eradication. (PA Report, Pg. 14-17)",
                        "Harvesting and Collection": "The average harvesting interval is 16 days. Productivity is generally acceptable, though earnings in some blocks are below the basic wage. Infield evacuation uses 1 Badang and 1 Mini Dumper. (PA Report, Pg. 38)",
                        "Crop Production": "YTD August 2025 yield is 12.09 t/ha, which is 17% below the 14.57 t/ha achieved in the same period of 2024. The shortfall is due to a shortage of harvesters, resulting in 13 harvesting rounds instead of the budgeted 16. (PA Report, Pg. 37)",
                        "Production Cost": "N/A",
                        "Vehicles Running Cost": "N/A",
                        "Capital Expenditure": "N/A",
                        "Immature": "R21 (Rubber): Growth is uneven, and supplying of 2,100 points is still pending. PR23 (OP): Field conditions are acceptable; 200 palms still need supplying. PR21/H (OP): Field conditions are satisfactory, but basal pruning is still in progress. (PA Report, Pg. 43-51)"
                    }
                },
                "policy": "<p>No specific policy cross-references were available in the provided reports.</p>"
            };

            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate();
                    populateInternalDropdowns();
                    attachEventListeners();
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-red-50 text-red-800' :
                                       metric.title.includes('Weeding') ? 'bg-yellow-50 text-yellow-800' : 'bg-purple-50 text-purple-800';
                    let content;
                    if (metric.lines) {
                        content = metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('');
                    } else {
                        content = `<p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass} shadow-sm">
                                <h3 class="font-semibold text-sm mb-1">${metric.title}</h3>
                                ${content}
                            </div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="bg-gray-50 p-3 rounded-lg flex items-start space-x-4">
                        <div class="flex-shrink-0 bg-gray-200 p-2 rounded-full mt-1">
                            ${metric.icon}
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">${metric.label}</p>
                            <p class="font-bold text-lg">${metric.value}</p>
                            ${metric.note ? `<p class="text-xs text-gray-500">${metric.note}</p>` : ''}
                        </div>
                    </div>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8">
                            <h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">FFB Yield by Block (YTD August)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('')}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'YTD 2025 FFB Yield (t/ha)', data: estateData.chartData.production.ytd2025, backgroundColor: '#4f46e5' },
                                { label: 'YTD 2024 FFB Yield (t/ha)', data: estateData.chartData.production.ytd2024, backgroundColor: '#a5b4fc' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, title: { display: true, text: 'Tonnes per Hectare' } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#8B5CF6', '#3B82F6', '#10B981', '#F59E0B', '#EF4444'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const policyData = "<p>No specific policy cross-references were available in the provided reports.</p>";
            modalTitle.innerText = `Agricultural Policy Cross-Reference: Ladang Sungai Beranang`;
            modalContent.innerHTML = policyData;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>

