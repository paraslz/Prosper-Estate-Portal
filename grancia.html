<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang Grancia - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Grancia Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "grancia",
                "name": "Ladang Grancia",
                // UPDATED: Report info reflects the new Agronomy Report date
                "reportInfo": "Data based on PA Report (September 2025) & Agronomy Report (September 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 205.00 ha",
                            "Mature: 146.00 ha",
                            "Immature: 59.00 ha"
                        ]
                    },
                    // UPDATED: Yield metrics from new AR
                    "yield": {
                        "title": "Yield/Ha (YTD Sep '25 vs '24)",
                        "value": "21.74 / 21.96 MT",
                        "note": "YTD 1% above last year (Source: AR Pg. 32)"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne",
                        "value": "N/A",
                        "note": "Pinfosys data not available"
                    },
                    "pests": {
                        "title": "Key Pests & Diseases",
                        "value": "Ganoderma & Oryctes",
                        "note": "Ganoderma spreading; Oryctes extensive"
                    },
                    "weeding": {
                        "title": "Weeding Progress",
                        "value": "Generally on Schedule",
                        "note": "Productivity & quality issues noted"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1:14 ha (Acceptable)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "High (Ganoderma, Oryctes)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER %", "value": "N/A" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "~1.3-2.3 MT/md (Can improve)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "~14-17 days (Good)" },
                    // UPDATED: Manuring status from new AR
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Manuring Status", "value": "On Progress (93% as of Aug)" }
                ],
                // UPDATED: Chart data now uses 2025 FFB (from chart) and 2025 Rainfall (from table)
                 "chartData": {
                    "production": {
                        "labels": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                        "ffb": [280, 260, 270, 310, 380, 350, 500, 460, 400, 0, 0, 0], // FFB 2025 (YTD Sep) from AR Pg. 34
                        "rainfall": [113, 81, 71, 325, 110, 221, 135, 57, 186, 0, 0, 0], // Rainfall 2025 (YTD Sep) from AR Pg. 40
                        "note": "*Production (MT) & Rainfall (mm) data for YTD September 2025. (Source: AR Pg. 34, 40)"
                    },
                    "ageProfile": {
                        "labels": ["Immature (PR24)", "P2018 (Young)", "P2016 (Prime)", "P2013 (Prime)", "P1999 (Old)"],
                        "data": [28.8, 24.9, 29.6, 10.4, 6.3], // ha: 59, 51, 60.65, 21.35, 13
                        "title": "Ladang Grancia - Palm Age Distribution (205 ha)",
                        "note": "*Source: AR Pg. 7."
                    }
                },
                // UPDATED: Observations are now a blend of new AR and existing PA report issues
                "observations": [
                    "<b>Oryctes Infestation in Immature Area:</b> Extensive Oryctes (Rhinoceros beetle) damage persists in the PR24 replant, contributing to variable palm size. Both reports identify this as a critical issue requiring urgent control. <span class='observation-ref'>(PA Report & AR Pg. 27-28)</span>",
                    "<b>Spreading Ganoderma Infection:</b> Ganoderma infection is confirmed in the oldest block (P99), with 121 infected palms, and has also been observed in the younger P16 planting, indicating spread. <span class='observation-ref'>(PA Report & AR Pg. 19)</span>",
                    "<b>Manuring Program Issues:</b> While progress is better (93% by Aug), the new AR highlights poor application *quality* in P13 (narrow banding). This, combined with low productivity noted in the PA report, impacts overall efficiency and nutrient uptake. <span class='observation-ref'>(PA Report & AR Pg. 9-10)</span>",
                    "<b>Inconsistent Field Upkeep Standards:</b> The new AR highlights significant under-pruning in P99 and over-spraying in P16. This, along with low weeding productivity from the PA report, shows a need for better supervision and quality control. <span class='observation-ref'>(PA Report & AR Pg. 13-14, 16-17)</span>",
                    "<b>Cattle Intrusion:</b> The Sept 2025 Agronomy report identifies unresolved cattle intrusion in P18 as an ongoing issue damaging palms. <span class='observation-ref'>(AR Pg. 23-24)</span>",
                    "<b>Stagnant Road Maintenance:</b> No road grading has been done YTD due to a contractor rate disagreement. This remains a critical logistical risk, especially with the rainy season approaching. <span class='observation-ref'>(PA Report)</span>"
                ],
                "reports": {
                    // UPDATED: Entire agronomy section is replaced with new data
                    "agronomy": {
                        "Executive Summary": "Overall agronomic conditions have shown improvement. Manuring progress is better this year (93% complete by Aug), though application quality needs improvement. Yield to date (Sept 2025) is 1% above the same period last year. Key challenges include significant under-pruning in P99, extensive Oryctes infestation in the PR24 immature area, and unresolved cattle intrusion in P18. (Source: AR, Pg. 4-5, 8, 23, 27)",
                        "Nutrient Inputs/Progress of Manuring": "The 2025 manuring program is 93% complete as of August, an improvement from 2024. However, some delays in Mixture B and Compound were noted. Quality of application in P13 was poor (narrow fertilizer band), which is not ideal for nutrient uptake and needs correction. (Source: AR, Pg. 8-10)",
                        "Agronomic Observation": "Mature (P99, P13, P16): Palm appearance is acceptable, but localized 'orange fronds' (Mg deficiency) persist in P13 & P16. Harvesting intervals are good (14-17 days). Pruning in P99 is unsatisfactory (under-pruned). Weeding is generally acceptable but with some over-spraying in P16. Ganoderma is significant in P99 (121 palms). Rat damage is low but fresh attacks are still evident. (Source: AR, Pg. 11-20)\n\nYoung Mature (P18): Field upkeep is satisfactory. Pruning and weeding are on schedule. Cattle intrusion remains an unresolved issue. (Source: AR, Pg. 21-24)\n\nImmature (PR24): Palm size is variable, partly due to 'extensive Oryctes infestation'. Rat control is successful. Weeding is slightly behind schedule, and selective weeding is needed to clear undesirable patches. (Source: AR, Pg. 25-31)",
                        "Yield Performance": "YTD September 2025 average yield is 21.74 MT/ha, a 1% increase from 21.96 MT/ha in the same 2024 period. P99 yield remains high, while P16 and P18 show expected growth. P13 (tissue culture) saw a 5% decline but is expected to produce >30 mt/ha for the year. (Source: AR, Pg. 32-34)",
                        "Fertilizer Recommendation": "The 2026 program recommends Mixture B for all mature palms and Compound fertilizer for the PR24 immature area. Kieserite will be applied to P13, P16, and P18 to correct Magnesium deficiencies. Rock Phosphate is also programmed for P13, P16, and P18. (Source: AR, Pg. 35-37)"
                    },
                    // UNCHANGED: Plantation section is retained from the previous file
                    "plantation": {
                        "Executive Summary": "The workforce is adequate and stable. Key challenges include controlling the high incidence of Oryctes in the new replant and managing the spread of Ganoderma. Worker productivity for manuring and weeding needs improvement to ensure higher wages and prevent turnover. Road grading must be completed before the rainy season. (Source: PAR, Pg. 30-31)",
                        "Area Statement": "Total planted area is 205.00 ha, consisting of 146.00 ha mature palms (P99, P13, P16, P18) and 59.00 ha immature (PR24). There have been no changes to the area statement. (Source: PAR, Pg. 8)",
                        "Labour Statement": "The estate has 15 workers against a requirement of 16, with a shortage of one manurer. The worker-to-land ratio is 1:14 ha, which is acceptable. Harvester numbers are adequate at a 1:18 ha ratio. (Source: PAR, Pg. 9)",
                        "Staff Establishment": "There has been no change in staff. The Assistant Manager is also tasked with managing mature rubber at another estate. (Source: PAR, Pg. 10)",
                        "Upkeep and Cultivation": "Weeding is on schedule, with circle and selective spraying programs 100% and 105% completed, respectively. However, circle spraying productivity (3.8 ha/md) is below target. The 2025 manuring program is 97% complete as of August. Manuring productivity is low (20 bags/md), resulting in poor worker earnings. (Source: PAR, Pg. 11-16)",
                        "Harvesting and Collection": "The harvesting interval averages a good 14 days. Harvester productivity varies by block (1.32 to 2.27 MT/md) with earnings generally above the basic wage. (Source: PAR, Pg. 24)",
                        "Crop Production": "YTD August 2025 yield is 19.19 MT/ha, which is 0.73% above the same period in 2024 but 10% below budget. The shortfall is attributed to a low cropping season earlier in the year. (Source: PAR, Pg. 23-24)",
                        "Production Cost": "N/A",
                        "Immature (PR24 - 59 ha)": "Weeding and manuring are generally on schedule. However, Oryctes (Rhinoceros beetle) attacks are extensive, and the current control measures (spraying once a month) are inadequate. The estate has been advised to increase spraying to twice a month. 200 out of 250 supplying palms have been planted. (Source: PAR, Pg. 26-29)"
                    },
                    "pinfosys": "Not Available"
                },
                // UNCHANGED: Policy section is retained
                "policy": "<div class='policy-item'><p class='font-semibold'>Oryctes Control</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Oryc-02:</b> For immature areas with >5% infestation, chemical spraying frequency must be increased to twice monthly until the situation is under control.</p></div> <div class='policy-item'><p class='font-semibold'>Ganoderma Management</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Gano-03:</b> Upon identification of infection in new blocks, a full census must be initiated within 60 days to determine the extent of the spread and formulate a management plan.</p></div> <div class='policy-item'><p class='font-semibold'>Worker Productivity & Wages</p><p class='text-sm text-gray-600'><b>Policy Ref: HR-WAGE-07:</b> If average task earnings consistently fall below the daily basic wage, management must conduct a review of the task, piece rates, or equipment to ensure fair compensation.</p></div> <div class='policy-item'><p class='font-semibold'>Road Maintenance</p><p class='text-sm text-gray-600'><b>Policy Ref: INFRA-ROAD-01:</b> Annual road grading must be completed before the peak rainfall season (typically by end of Q3) to ensure uninterrupted estate access.</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Pests') ? 'bg-red-50 text-red-800' : 'bg-yellow-50 text-yellow-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { 
                            responsive: true, 
                            maintainAspectRatio: false, 
                            scales: { 
                                x: { grid: { display: false } }, 
                                'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 
                                'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } 
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.parsed.y !== null && context.parsed.y !== 0) {
                                                label += context.parsed.y;
                                            } else {
                                                label += 'N/A'; // Show N/A for 0 values (future months)
                                            }
                                            return label;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#fde047', '#facc15', '#eab308', '#ca8a04', '#a16207'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                // FIX: Changed estate.id to estateData.id
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                // FIX: Changed estate.id to estateData.id
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);
                
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600 whitespace-pre-line">${content}</p>`).join('');
                } else if (agronomyDiv) {
                    agronomyDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }

                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600 whitespace-pre-line">${content}</p>`).join('');
                } else if (plantationDiv) {
                    plantationDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }

                if (pinfosysDiv && estateData.reports.pinfosys === "Not Available") {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modal = document.getElementById('policyModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            // FIX: Changed hardcoded name to dynamic name from estateData
            const estateName = estateData.name;
            // FIX: Removed unused policyData variable
            
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estateName}`;
            modalContent.innerHTML = estateData.policy;
            modal.classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>

