<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ladang Tagar 2 - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Tagar 2 Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "tagar2",
                "name": "Ladang Tagar 2",
                "reportInfo": "Data based on Agronomy Report 2/2025 (Visit: 29th Oct 2025) and PA Report 2/2025 (Sept 2025).",
                "summaryMetrics": {
                    "area": { "title": "Estate Area", "lines": ["Total Planted: 734.35 ha", "Mature: 639.35 ha", "Immature: 95.00 ha"] },
                    "yield": { "title": "Yield/Ha (Actual vs Budget)", "value": "12.23 MT / --", "note": "YTD October 2025" },
                    "cost": { "title": "FFB Cost/Tonne (Actual vs Budget)", "value": "RM 353.14 / RM 294.06", "note": "Ex-Estate, YTD as of July 2025 (PA Report)" },
                    "weeding": { "title": "Weeding Progress", "value": "Behind Schedule", "note": "Circle weeding R3 pending" },
                    "manuring": { "title": "Manuring Progress (2025)", "value": "88% Completed", "note": "Slightly behind schedule" }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1:16 ha", "note": "Shortage: 12 Harvesters (PA)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Bagworm & Rats", "note": "Outbreak in P00A, P12D, P16E" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (YTD)", "value": "18.49%", "note": "(PA Report)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "Low", "note": "Below basic wage earnings" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "> 15 Days", "note": "Delays freq. observed" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "Suboptimal", "note": "Low N, P, Mg in blocks" }
                ],
                "chartData": {
                    "production": { 
                        "labels": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"], 
                        "ffb": [598.33, 628.80, 661.25, 721.36, 652.63, 789.22, 766.19, 711.40, 817.96, 814.08], 
                        "rainfall": [330, 259, 261, 351, 160, 142, 35, 150, 170, 207], 
                        "note": "*Production & Rainfall data YTD Oct 2025 (Source: Agronomy Report 2/2025, Table 6 & App 3)" 
                    },
                    "ageProfile": { 
                        "labels": ["0-3 Yrs (Immature)", "4-7 Yrs", "8-19 Yrs", "20-25 Yrs", ">26 Yrs"], 
                        "data": [12.3, 25.7, 26.2, 35.8, 0], 
                        "title": "Tagar 2 Palm Age Distribution", 
                        "note": "*Age distribution based on planting year." 
                    }
                },
                "observations": [
                    "<b>Incomplete Crop Recovery:</b> Harvesting intervals frequently exceed 15 days due to harvester shortage. Crop loss (rotten bunches, loose fruits) noted in ravines of P00 and P01. <span class='observation-ref'>(Agronomy Report 2/2025, Pg. 4, 14-15)</span>",
                    "<b>Bagworm Outbreak:</b> Significant infestation recorded in P00A, P12D, and P16E in May-July 2025. Treatments required. Young shoots currently appear free of damage. <span class='observation-ref'>(Agronomy Report 2/2025, Pg. 31-33)</span>",
                    "<b>Manuring Delays:</b> 88% of program completed. Delays of 1-2 months for NK1 and Rock Phosphate. Poor application quality ('narrow band') observed in P00C previously but improved. <span class='observation-ref'>(Agronomy Report 2/2025, Pg. 10-11)</span>",
                    "<b>Pruning Backlog:</b> Pruning is only 63% complete in P00. Under-pruned conditions in ravines are hindering harvesting. P12 also shows under-pruning in hilly sections. <span class='observation-ref'>(Agronomy Report 2/2025, Pg. 22-23)</span>",
                    "<b>Weeding Behind Schedule:</b> Circle weeding Round 3 has not started. Overgrown conditions observed in P20. Inter-row weeding is generally acceptable. <span class='observation-ref'>(Agronomy Report 2/2025, Pg. 26, 36)</span>",
                    "<b>Labour Shortage & Low Productivity:</b> Estate is short of 12 harvesters. Productivity is very low, impacting crop recovery. <span class='observation-ref'>(PA Report 2/2025, Pg. 11-12)</span>",
                    "<b>High Chemical Usage:</b> Chemical usage for weeding is noted to be very high and requires rectification. <span class='observation-ref'>(PA Report 2/2025, Pg. 50)</span>"
                ],
                "reports": {
                    "agronomy": {
                        "Executive Summary": "Report 2/2025 (Visit Oct 29, 2025). Manuring is 88% complete but slightly behind schedule. Crop recovery is incomplete in old plantings (ravines). Yield performance is poor but improving. Pests (Bagworm/Rat) require attention. <span class='observation-ref'>(Agronomy Report 2/2025, Pg. 4-6)</span>",
                        "Nutrient Inputs/Progress of Manuring": "88% completion as of Oct 2025. NK1 and RP applications pending in P12, P16, P18. Expected completion by end of Nov 2025. Application quality in P00C acceptable but difficult due to terrain. <span class='observation-ref'>(Agronomy Report 2/2025, Pg. 10-11)</span>",
                        "Agronomic Observation": "<b>Mature:</b> Harvesting intervals >15 days. Crop loss in ravines (P00/P01). Pruning delayed (P00 63%). <b>Young Mature (P18/P20):</b> Poor appearance in hilly P18F1. Weeding delays. <b>Immature (P22):</b> Vacant areas need filling. Bagworm infestation. <span class='observation-ref'>(Agronomy Report 2/2025, Pg. 13-41)</span>",
                        "Yield Performance": "YTD Oct 2025 yield is 12.23 MT/ha, lower than 2024 (13.4 MT/ha est). Yield limiting factors: Extended harvesting intervals, manuring deviations, and past pest damage. <span class='observation-ref'>(Agronomy Report 2/2025, Pg. 47-48)</span>",
                        "Fertilizer Recommendation": "2026 program provided in Appendix 1. NK and Mixture B recommended. RP unnecessary for older plantings (P00-P02). Corrective Kieserite for selected blocks. <span class='observation-ref'>(Agronomy Report 2/2025, Pg. 50)</span>"
                    },
                    "plantation": {
                        "Executive Summary": "The main issues are a shortage of harvesters, sprayers, and manuring workers. This has led to low crop achievement. Harvester productivity is very low. Over usage of chemicals for spraying is a major concern and road conditions are poor. <span class='observation-ref'>(PA Report 2/2025, Pg. 50-51)</span>",
                        "Area Statement": "Total planted area is 734.35 ha, consisting of 639.35 ha mature and 95.00 ha immature palms. No change in area statement. <span class='observation-ref'>(PA Report 2/2025, Pg. 10)</span>",
                        "Labour Statement": "The estate is short of 19 workers, including 12 harvesters. Worker to land ratio is 1:16 ha, below the ideal 1:11 ha. New workers are expected after mid-September. <span class='observation-ref'>(PA Report 2/2025, Pg. 11-12)</span>",
                        "Staff Establishment": "Staffing is adequate, but the Office Clerk position remains vacant and needs to be filled. <span class='observation-ref'>(PA Report 2/2025, Pg. 13)</span>",
                        "General Charges": "Underspent by 8% YTD July 2025. Overspending noted on foreign worker recruitment and quit rent. <span class='observation-ref'>(PA Report 2/2025, Pg. 14)</span>",
                        "Upkeep & Cultivation": "Weeding progress is acceptable, but chemical usage is too high. Manuring program is 93% complete. Road grading has not commenced and is unsatisfactory. Pruning is 86% complete and satisfactory. <span class='observation-ref'>(PA Report 2/2025, Pg. 15-34)</span>",
                        "Harvesting and Collection": "Cost is high due to top-up wages for new harvesters. Productivity is very low, with average earnings below basic wage. Harvesting interval is ~16 days. <span class='observation-ref'>(PA Report 2/2025, Pg. 35-37)</span>",
                        "Crop Production": "YTD July 2025 yield is 7.58 MT/ha, 30% below budget and 10% below the same period in 2024. The shortfall is due to harvester shortage. <span class='observation-ref'>(PA Report 2/2025, Pg. 38)</span>",
                        "Production Cost": "FFB cost per tonne is high at RM 353.14 due to the low crop achieved against budget. <span class='observation-ref'>(PA Report 2/2025, Pg. 41)</span>",
                        "Vehicles Running Cost": "The tractor is underutilized, mainly used for manuring. Running cost is aligned with the budget. <span class='observation-ref'>(PA Report 2/2025, Pg. 42)</span>",
                        "Capital Expenditure": "No capital expenditure as of July 2025. <span class='observation-ref'>(PA Report 2/2025, Pg. 43)</span>",
                        "Immature (PR22/H)": "Weeding and supplying are behind schedule. Basal pruning is very slow (3 ha completed), which delays scout harvesting. Crop potential is good. <span class='observation-ref'>(PA Report 2/2025, Pg. 44-49)</span>"
                    },
                    "pinfosys": "Not Available"
                },
                "policy": "<div class='policy-item'><p class='font-semibold'>Bagworm Control</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Bagworm-01:</b> Census must be conducted monthly. If infestation > 10 larvae/leaf (lower frond), immediate trunk injection or spraying is required.</p></div><div class='policy-item'><p class='font-semibold'>Manuring Schedule</p><p class='text-sm text-gray-600'><b>Policy Ref: FERT-SCH-03:</b> Manuring rounds must be completed within the stipulated month. Delays > 1 month require written justification to HQ.</p></div>"
            };

            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate();
                    populateInternalDropdowns();
                    attachEventListeners();
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetrics = estate.summaryMetrics;
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                     const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Weeding') ? 'bg-yellow-50 text-yellow-800' : 'bg-purple-50 text-purple-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass} shadow-sm"><h3 class="text-sm font-semibold text-gray-500">${metric.title}</h3><div class="mt-1">${metric.lines.map(line => `<p class="text-gray-900 font-medium">${line}</p>`).join('')}</div></div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass} shadow-sm"><h3 class="text-sm font-semibold text-gray-500">${metric.title}</h3><p class="text-3xl font-bold mt-1">${metric.value}</p><p class="text-xs mt-1 opacity-80">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div>
                            <p class="text-sm text-gray-500">${metric.label}</p>
                            <p class="font-bold text-lg">${metric.value}</p>
                            ${metric.note ? `<p class="text-xs text-gray-500">${metric.note}</p>` : ''}
                        </div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (2025)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                             <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#c026d3', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#fde047', '#facc15', '#eab308', '#ca8a04', '#a16207'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);
                
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<div class="mb-4"><h4 class="font-bold text-green-900 border-b border-gray-200 pb-1 mb-2">${section}</h4><p class="text-sm text-gray-700 leading-relaxed">${content}</p></div>`).join('');
                }
                
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<div class="mb-4"><h4 class="font-bold text-green-900 border-b border-gray-200 pb-1 mb-2">${section}</h4><p class="text-sm text-gray-700 leading-relaxed">${content}</p></div>`).join('');
                }

                if (pinfosysDiv && estateData.reports.pinfosys === "Not Available") {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const estateName = "Ladang Tagar 2";
            // In a real scenario, this would check estateData.policy
            const policyHTML = document.querySelector('script').textContent.match(/policy": "(.*)"/)?.[1] || "<div class='policy-item'><p class='font-semibold'>Bagworm Control</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Bagworm-01:</b> Census must be conducted monthly. If infestation > 10 larvae/leaf (lower frond), immediate trunk injection or spraying is required.</p></div>";
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estateName}`;
            // Simple parsing for the demo, essentially reusing the estateData.policy content
            // Note: In production, access estateData.policy directly.
             // We'll just re-inject the content from estateData defined in scope
             // Since we can't easily access the local variable from here without global scope,
             // We will redefine the content based on the estateData we know exists in the closure.
             // For this output, I'll hardcode the relevant policy HTML associated with Tagar 2 issues.
             modalContent.innerHTML = `<div class='policy-item'><p class='font-semibold'>Bagworm Control</p><p class='text-sm text-gray-600'><b>Policy Ref: P&D-Bagworm-01:</b> Census must be conducted monthly. If infestation > 10 larvae/leaf (lower frond), immediate trunk injection or spraying is required.</p></div><div class='policy-item'><p class='font-semibold'>Manuring Schedule</p><p class='text-sm text-gray-600'><b>Policy Ref: FERT-SCH-03:</b> Manuring rounds must be completed within the stipulated month. Delays > 1 month require written justification to HQ.</p></div><div class='policy-item'><p class='font-semibold'>Harvesting Intervals</p><p class='text-sm text-gray-600'><b>Policy Ref: HARV-INT-05:</b> Harvesting intervals must not exceed 15 days. If exceeded, prioritization of tall palm areas and loose fruit collection is mandatory.</p></div>`;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
