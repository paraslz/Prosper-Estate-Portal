<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ladang Sungai Enggang - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #4a5568; }
        .policy-item { border-left: 3px solid #6366f1; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Sungai Enggang Report
                </a>
            </div>
            <a href="estates.html" class="text-indigo-600 hover:text-indigo-800 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "sgenggang",
                "name": "Ladang Sungai Enggang",
                "reportInfo": "Data based on Agronomy Report 1/2025 (June 2025) and Plantation Advisory Report 1/2025 (July 2025).",
                "summaryMetrics": {
                    "area": { "title": "Estate Area", "lines": ["Total: 2,809.16 ha", "Mature: 2,163.31 ha", "Immature: 645.85 ha"] },
                    "yield": { "title": "Yield/Ha (YTD)", "value": "6.03 MT", "note": "As of May 2025" },
                    "cost": { "title": "FFB Cost/Tonne", "value": "RM 226.07", "note": "As of May 2025" },
                    "weeding": { "title": "Weeding Progress", "value": "Behind Schedule", "note": "Circle weeding at 86%" },
                    "manuring": { "title": "Manuring Progress", "value": "36%", "note": "As of May 2025, slow progress" }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester", "value": "33 Short" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER %", "value": "18.99%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvest Rounds", "value": "67% of Target" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": ">20 Days" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Under Control" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "Mild K Deficiency" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                        "ffb": [2117, 2998, 2372, 3258, 3513, 0, 0, 0, 0, 0, 0, 0],
                        "rainfall": [531.8, 77, 306.7, 285.4, 387, 0, 0, 0, 0, 0, 0, 0],
                        "note": "*Production & Rainfall data as of May 2025."
                    },
                    "ageProfile": {
                        "labels": ["Immature (0-3 Yrs)", "Young Mature (4-7 Yrs)", "Prime Mature (8-19 Yrs)", "Old Mature (20-25 Yrs)", ">25 Yrs"],
                        "data": [17, 2, 0, 19, 63],
                        "title": "Sg. Enggang Palm Age Distribution",
                        "note": "*Age distribution based on planting year. (Agronomy Report, Pg. 11)"
                    }
                },
                "observations": [
                    "<b>Harvester Shortage:</b> The estate is short of 33 harvesters, leading to extended harvesting intervals (>20 days) and poor crop recovery. (Plantation Advisory, Pg. 11, 40)",
                    "<b>Low Worker Productivity:</b> Sprayer productivity is low, with workers operating for shorter hours. Mist blower nozzle calibration needs monitoring to prevent chemical wastage. (Plantation Advisory, Pg. 20)",
                    "<b>Delayed Manuring:</b> Manuring progress is slow at only 36% completion by May 2025, mainly due to rain. Fertilizer storage conditions need improvement. (Agronomy Report, Pg. 16)",
                    "<b>Under-Pruning:</b> Progressive pruning is delayed in P96C and P96D due to high worker turnover, resulting in excessive dried fronds. (Agronomy Report, Pg. 26)",
                    "<b>Weed Control:</b> Circle weeding is behind schedule. Undesirable weeds like Ageratum conyzoides and Hedyotis verticillata require targeted control. (Agronomy Report, Pg. 32)",
                    "<b>Pest Control:</b> Rat damage is below the threshold, but bagworm infestations along roadsides required treatment. Cattle intrusion is a concern for spreading pests. (Plantation Advisory, Pg. 35)"
                ],
                "reports": {
                    "agronomy": {
                        "Executive Summary": "A routine agronomy visit was conducted on 19th June 2025. Agronomic conditions were inspected, yield-limiting factors were highlighted, and the 2025 fertilizer program was reviewed. Key issues identified include slow manuring progress, extended harvesting intervals, under-pruning in specific blocks, and localized potassium deficiency. (Agronomy Report, Pg. 9)",
                        "Nutrient Inputs/Progress of Manuring": "As of May 2025, manuring completion was only at 36%, significantly behind schedule due to rain. Delays of over 3 months are to be avoided. Fertilizer storage needs improvement, with bags currently on wet ground instead of pallets, risking quality deterioration. (Agronomy Report, Pg. 14-16)",
                        "Agronomic Observation": "Harvesting intervals frequently exceeded 20 days due to a harvester shortage, leading to over-ripe bunches and poor crop recovery. Pruning was unsatisfactory in fields P96C and P96D. Palm appearance is generally acceptable, though mild potassium deficiency was noted. Inter-row weeding is acceptable, but circle weeding is behind schedule with undesirable weed growth. (Agronomy Report, Pg. 22-32)",
                        "Yield Performance": "The average estate yield declined by 6.3% from Jan-May 2025 compared to the same period in 2024. This is attributed to harvesting delays, with most fields falling short of targeted harvesting rounds. In 2024, the yield had increased by 36% to 18.29 mt/ha. (Agronomy Report, Pg. 60-62)",
                        "Fertilizer Recommendation": "No amendments were made to the 2025 fertilizer program. The estate must ensure the program is completed on schedule. The 2026 program will be formulated after the next field inspection. (Agronomy Report, Pg. 64)"
                    },
                    "plantation": {
                        "Executive Summary": "The advisory visit on 9th July 2025 noted a critical shortage of harvesters and sprayers, impacting field operations. While general charges are under control, key concerns include high harvester turnover, low sprayer productivity, and the need to improve work methods to retain labor. The replanting standard is acceptable, but weeding in immature areas needs attention. (Plantation Advisory, Pg. 4, 7, 60-61)",
                        "Area Statement": "Total planted area is 2809.16 ha, with 2163.31 ha mature and 477.5 ha immature. A replanting of 168.35 ha (PR25/K) was carried out in 2025. The replanting for 2026 has been deferred. (Plantation Advisory, Pg. 9-10)",
                        "Labour Statement": "The estate has 128 workers against a requirement of 197, with a significant shortage of 33 harvesters and 30 sprayers. The worker-to-land ratio is 1:22 ha, which is inadequate. Recruitment efforts are underway. (Plantation Advisory, Pg. 11-12)",
                        "Staff Establishment": "The staff complement is acceptable, but a vacant Assistant Manager position needs to be filled to manage the extensive replanting areas. (Plantation Advisory, Pg. 13)",
                        "General Charges": "General charges were 30% underspent against the budget as of May 2025 and are considered well-controlled. (Plantation Advisory, Pg. 14)",
                        "Upkeep & Cultivation": "Circle spraying is behind at 86% completion, with low worker productivity. Selective spraying is at 75% completion. Manuring progress is at 96% of the budgeted area. Pruning is at 43% completion, with some quality issues in P20/H1. (Plantation Advisory, Pg. 15, 19, 26, 31)",
                        "Harvesting and Collection": "Harvesting rounds achieved were only 6.75 against a budget of 10 due to harvester shortages. Harvester productivity in older plantings is low, resulting in earnings below the basic wage, contributing to high turnover. (Plantation Advisory, Pg. 40-41)",
                        "Crop Production": "YTD FFB yield as of May 2025 is 6.59 mt/ha, which is 16% below budget and 13% below the previous year, primarily due to the harvester shortage. OER is 18.99%. (Plantation Advisory, Pg. 43)",
                        "Production Cost": "The production cost per tonne of FFB is RM 226.07, which is considered acceptable due to low expenditure on General Charges and Upkeep. (Plantation Advisory, Pg. 46)",
                        "Vehicles Running Cost": "Running costs for the Manager's vehicles were acceptable. (Plantation Advisory, Pg. 58)",
                        "Capital Expenditure": "No capital expenditure has been spent from the RM 905,150 budget. (Plantation Advisory, Pg. 59)",
                        "Immature": "Weeding in PR23I needs improvement to control VOPs, Stenochlaena, and Asystasia. In PR24J, circles and paths are grassy and require wider spraying. Oryctes control is ongoing and appears effective in both areas. (Plantation Advisory, Pg. 48, 52)"
                    },
                    "pinfosys": {
                        "Report Status": "The Pinfosys Report is not available for this period."
                    }
                },
                "policy": "<p>Policy cross-references are not yet available for this estate.</p>"
            };


            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate();
                    populateInternalDropdowns();
                    attachEventListeners();
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-red-50 text-red-800' :
                                       metric.title.includes('Weeding') ? 'bg-yellow-50 text-yellow-800' : 'bg-purple-50 text-purple-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#c026d3', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#34D399', '#FBBF24', '#60A5FA', '#F87171', '#9333EA'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                 if (pinfosysDiv && estateData.reports.pinfosys) {
                    pinfosysDiv.innerHTML = Object.entries(estateData.reports.pinfosys).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const estateData = {
                "id": "sgenggang",
                "name": "Ladang Sungai Enggang",
                "policy":"<p>Policy cross-references are not yet available for this estate.</p>"
            };
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estateData.name}`;
            modalContent.innerHTML = estateData.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
