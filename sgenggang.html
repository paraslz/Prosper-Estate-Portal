<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ladang Sungai Enggang - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Sungai Enggang Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "sgenggang",
                "name": "Ladang Sungai Enggang",
                "reportInfo": "Data based on PA Report 2/2025 (Visit: 10 Dec 2025) & Agronomy Report 1/2025 (June 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 2,809.16 ha",
                            "Mature: 2,163.31 ha",
                            "Immature: 645.85 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (Actual vs Budget)",
                        "value": "11.55 / 14.88 MT",
                        "note": "YTD Sept 2025 (22% Below Budget)"
                    },
                    "cost": {
                        "title": "Production Cost (Upkeep+Harv)",
                        "value": "RM 190.24/MT",
                        "note": "YTD Sept 2025"
                    },
                    "manuring": {
                        "title": "Manuring Progress",
                        "value": "98% Completed",
                        "note": "Output: 40 bags/man day"
                    },
                    "weeding": {
                        "title": "Circle Weeding",
                        "value": "87% Completed",
                        "note": "Behind Schedule (Shortage of sprayers)"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Shortage", "value": "24 Pax (Ratio 1:31 ha)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (YTD)", "value": "18.99%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "Harvest Interval", "value": "23 Days (Dec)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z' /></svg>", "label": "Harvest Rounds", "value": "13.5 (Target 18)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z' /></svg>", "label": "Pest Alert", "value": "Rats (P20/H)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "Manuring Status", "value": "Satisfactory (98%)" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                        "ffb": [2117, 2998, 2372, 3258, 3513, 3000, 3100, 2900, 2497, 0, 0, 0], 
                        "rainfall": [531.8, 77, 306.7, 285.4, 387, 200, 150, 180, 220, 0, 0, 0],
                        "note": "*YTD Production (approx) vs Rainfall. Data partially derived from PA 2/2025."
                    },
                    "ageProfile": {
                        "labels": ["Immature (0-3 Yrs)", "Young Mature (4-7 Yrs)", "Prime Mature (8-19 Yrs)", "Old Mature (20-25 Yrs)", ">25 Yrs"],
                        "data": [23, 2, 0, 19, 56], 
                        "title": "Sg. Enggang Palm Age Distribution (2025)",
                        "note": "*Includes new replanting PR25K (168 ha)."
                    }
                },
                "observations": [
                    "<b>Critical Labour Shortage:</b> The estate is short of 24 harvesters (Ratio 1:31 ha). This is the primary driver for crop loss and delayed pruning. Total worker shortage is 41 pax. <span class='observation-ref'>(PA 2/2025, Pg. 10, 53)</span>",
                    "<b>Extended Harvest Intervals:</b> Harvesting intervals have extended to 23 days (Dec 2025), significantly above the acceptable standard. Rounds achieved were only 13.5 vs budget of 18. <span class='observation-ref'>(PA 2/2025, Pg. 35)</span>",
                    "<b>Pest Issues (Rats & Ganoderma):</b> Widespread rat damage observed in P20/H (requires immediate baiting). Ganoderma infection noted in P96/B and P96/D. <span class='observation-ref'>(PA 2/2025, Pg. 29-30)</span>",
                    "<b>Manuring Progress:</b> Status has improved significantly to 98% completion for the year. Output is satisfactory at 40 bags/man day. <span class='observation-ref'>(PA 2/2025, Pg. 14, 23)</span>",
                    "<b>Pruning Backlog:</b> Progressive pruning is only 50% completed. Abundant frond fractures seen. Requires corrective pruning when labor allows. <span class='observation-ref'>(PA 2/2025, Pg. 25-26)</span>",
                    "<b>Replanting Status (PR25/K):</b> 134 ha planted. Blanket spraying was delayed due to sprayer shortage, leading to unsatisfactory field conditions. <span class='observation-ref'>(PA 2/2025, Pg. 50)</span>",
                    "<b>Infrastructure:</b> Road grading was delayed due to weather. Drains with high sand content require desilting twice a year. <span class='observation-ref'>(PA 2/2025, Pg. 32-33)</span>"
                ],
                "reports": {
                    "plantation": {
                        "Executive Summary": "The estate faces a critical labour shortage crisis that is severely impacting operations. The shortage of harvesters and sprayers has caused significant crop loss and delays in upkeep programs. While FFB yield is 22% below budget, costs remain well controlled (underspent by 30% in General Charges). On a positive note, the manuring program is nearly complete (98%). Immediate recruitment is vital to restore the harvester ratio and normalize harvesting intervals. (Source: PA Report 2/2025, Pg. 53)",
                        "Area Statement": "The total planted area stands at 2,809.16 ha. The Mature area has been reduced to 2,163.31 ha due to ongoing replanting activities. The Immature area currently spans 645.85 ha, comprising recent replants (PR23/I, PR24/J, PR25/K). Management has confirmed that no new replanting is planned for the upcoming 2026 fiscal year. (Source: PA Report 2/2025, Pg. 9)",
                        "Labour Statement": "The labor situation is critical. The estate requires 171 workers but currently operates with only 120, resulting in a shortage of 41 pax (24% vacancy). Specifically, there is a shortage of 24 harvesters and 11 sprayers. The current harvester-to-land ratio has deteriorated to 1:31 ha, far exceeding the target of 1:23 ha. Recruitment of 16 new harvesters is expected by mid-December. (Source: PA Report 2/2025, Pg. 10)",
                        "Staff Establishment": "The staff complement is generally satisfactory and sufficient to manage current operations. However, there is a notable vacancy for one Assistant Manager position which needs to be filled to ensure adequate supervision across all divisions. (Source: PA Report 2/2025, Pg. 12)",
                        "General Charges": "General Charges are well managed, showing a 30% underspend as of September. However, it is noted that the Pinfosys report for October was delayed, which may affect the final year-end projection. (Source: PA Report 2/2025, Pg. 13)",
                        "Upkeep & Cultivation": "Field upkeep shows mixed results due to labor constraints. Manuring is a highlight, with 98% of the program completed satisfactorily. Conversely, Circle Weeding is lagging at 87% completion due to the sprayer shortage; the use of Controlled Droplet Application (CDA) is strongly recommended to improve coverage. Pruning is critically behind schedule at only 50% completion, leading to sanitation issues. EFB application is 63% complete but hampered by field access issues. (Source: PA Report 2/2025, Pg. 14-25)",
                        "Harvesting and Collection": "Harvesting performance is poor, primarily driven by the severe harvester shortage. The estate achieved only 13.5 harvesting rounds against a budget of 18 rounds. Consequently, harvesting intervals have drifted to 23 days in December, leading to high loose fruit wastage and crop loss. Harvester productivity is currently low as new recruits are still acclimatizing. (Source: PA Report 2/2025, Pg. 35-39)",
                        "Crop Production": "Production is significantly below target. YTD September Yield stands at 11.55 MT/ha against a budget of 14.88 MT/ha, representing a negative variance of 22%. When compared to the same period last year (14.12 MT/ha), the yield has dropped by 18%, emphasizing the impact of the labor shortage. (Source: PA Report 2/2025, Pg. 38)",
                        "Production Cost": "Despite the operational challenges, costs are relatively controlled. The Total Upkeep & Harvesting Cost is RM 190.24/MT (Actual) versus the budgeted RM 184.13/MT. While the cost per tonne is slightly higher than budget, the overall absolute expenditure is lower due to uncompleted field works. (Source: PA Report 2/2025, Pg. 40)",
                        "Vehicles Running Cost": "Vehicle running costs are underspent and remain well within the approved budget. No major overspending or mechanical issues were highlighted in this period. (Source: PA Report 2/2025, Pg. 51)",
                        "Capital Expenditure": "Capital Expenditure is significantly underspent, with RM 678k utilized against a budget of RM 905k. This indicates deferred projects or cost savings in procurement. (Source: PA Report 2/2025, Pg. 52)",
                        "Immature (PR23/I, PR24/J, PR25/K)": "Immature fields show varying progress. PR23/I is performing well with 83% weeding and 80% manuring completion; fruit set is good. PR24/J has achieved 100% manuring completion, though weeding is at 78% and requires Volunteer Oil Palm (VOP) eradication. The new planting, PR25/K (134 ha planted), is facing challenges with delayed blanket spraying due to the sprayer shortage. (Source: PA Report 2/2025, Pg. 41-50)"
                    },
                    "agronomy": {
                        "Executive Summary": "A routine agronomy visit was conducted on 19th June 2025. Agronomic conditions were inspected, yield-limiting factors were highlighted, and the 2025 fertilizer program was reviewed. Key issues identified include slow manuring progress (at the time), extended harvesting intervals, and under-pruning. (Source: Agronomy Report 1/2025, Pg. 9)",
                        "Nutrient Inputs/Progress of Manuring": "Note: Status updated in PA report to 98%. Previous report noted slow progress (36%) due to rain and storage issues. (Source: Agronomy Report 1/2025, Pg. 14-16)",
                        "Agronomic Observation": "Harvesting intervals frequently exceeded 20 days due to a harvester shortage. Pruning was unsatisfactory in fields P96C and P96D. Mild potassium deficiency noted. Inter-row weeding is acceptable. (Source: Agronomy Report 1/2025, Pg. 22-32)",
                        "Yield Performance": "Yield decline noted in first half of 2025 attributed to harvesting delays. (Source: Agronomy Report 1/2025, Pg. 60-62)",
                        "Fertilizer Recommendation": "No amendments made to the 2025 program. 2026 program to be formulated after next inspection. (Source: Agronomy Report 1/2025, Pg. 64)"
                    },
                    "pinfosys": {
                        "Status": "Not Available. Financial data partially integrated into Plantation Advisory Report."
                    }
                },
                "policy": "<div class='policy-item'><p class='font-semibold'>Labour & Harvesters</p><p class='text-sm text-gray-600'><b>Policy Ref: HR-REC-01:</b> Estate must maintain a harvester-to-area ratio of 1:15 ha (hilly) or 1:20 ha (flat). Shortages >10% must trigger immediate recruitment protocols.</p></div><div class='policy-item'><p class='font-semibold'>Harvesting Standards</p><p class='text-sm text-gray-600'><b>Policy Ref: OP-HARV-03:</b> Harvesting rounds must be maintained at 10-15 days. Intervals >20 days trigger mandatory 'block closure' reviews to prioritize crop recovery.</p></div><div class='policy-item'><p class='font-semibold'>Pest Control (Rats)</p><p class='text-sm text-gray-600'><b>Policy Ref: AGRO-PEST-02:</b> Rat baiting is mandatory when damage census exceeds 5%. Second rounds must be applied if damage persists >10%.</p></div>"
            };


            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate();
                    populateInternalDropdowns();
                    attachEventListeners();
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Weeding') ? 'bg-red-50 text-red-800' : 'bg-teal-50 text-teal-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (2025)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                             <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#fde047', '#facc15', '#eab308', '#ca8a04', '#a16207'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);
                
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<div class="mb-4"><h4 class="font-semibold text-gray-800 text-lg border-b border-gray-300 pb-1 mb-2">${section.replace(/([A-Z])/g, ' $1').trim()}</h4><p class="text-sm text-gray-700 leading-relaxed">${content}</p></div>`).join('');
                }
                
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<div class="mb-4"><h4 class="font-semibold text-gray-800 text-lg border-b border-gray-300 pb-1 mb-2">${section.replace(/([A-Z])/g, ' $1').trim()}</h4><p class="text-sm text-gray-700 leading-relaxed">${content}</p></div>`).join('');
                }

                if (pinfosysDiv && estateData.reports.pinfosys) {
                    pinfosysDiv.innerHTML = Object.entries(estateData.reports.pinfosys).map(([section, content]) => `<div class="mb-4"><h4 class="font-semibold text-gray-800 text-lg border-b border-gray-300 pb-1 mb-2">${section.replace(/([A-Z])/g, ' $1').trim()}</h4><p class="text-sm text-gray-700 leading-relaxed">${content}</p></div>`).join('');
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const estateData = {
                "name": "Ladang Sungai Enggang",
                "policy": "<div class='policy-item'><p class='font-semibold'>Labour & Harvesters</p><p class='text-sm text-gray-600'><b>Policy Ref: HR-REC-01:</b> Estate must maintain a harvester-to-area ratio of 1:15 ha (hilly) or 1:20 ha (flat). Shortages >10% must trigger immediate recruitment protocols.</p></div><div class='policy-item'><p class='font-semibold'>Harvesting Standards</p><p class='text-sm text-gray-600'><b>Policy Ref: OP-HARV-03:</b> Harvesting rounds must be maintained at 10-15 days. Intervals >20 days trigger mandatory 'block closure' reviews to prioritize crop recovery.</p></div><div class='policy-item'><p class='font-semibold'>Pest Control (Rats)</p><p class='text-sm text-gray-600'><b>Policy Ref: AGRO-PEST-02:</b> Rat baiting is mandatory when damage census exceeds 5%. Second rounds must be applied if damage persists >10%.</p></div>"
            };
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estateData.name}`;
            modalContent.innerHTML = estateData.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
