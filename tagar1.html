<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang Tagar 1 - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Tagar 1 Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "tagar1",
                "name": "Ladang Tagar 1",
                "reportInfo": "Data based on PA Report 2/2025 (Sept 2025) & Agronomy Report 2/2025 (September 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Total Planted: 1,846 ha",
                            "Mature: 1,226 ha",
                            "Immature: 464 ha",
                            "Replanting: 108 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (Actual vs Budget)",
                        "value": "8.83 / 9.69 MT*",
                        "note": "*Yield Actual YTD Aug 2025 (AR), Budget YTD July 2025 (PAR)"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (Actual vs Budget)",
                        "value": "RM 344.80 / RM 336.61",
                        "note": "YTD July 2025 (PAR)"
                    },
                     "manuring": {
                        "title": "Manuring Progress",
                        "value": "Delayed",
                        "note": "Most programs delayed by 2-3 months"
                    },
                     "weeding": {
                        "title": "Weeding Progress",
                        "value": "Delayed",
                        "note": "Second round pending in most fields"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1:16 ha (Shortage)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "High (Rats, Ganoderma, Cattle)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER % (YTD)", "value": "18.66%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "Low (~5 hrs/day)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "~16 days (>15 days)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "Suboptimal Mg Levels" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                        "ffb": [1420, 1410, 1380, 1290, 1480, 1590, 1710, 1700, 0, 0, 0, 0], 
                        "rainfall": [356, 263, 277, 486, 240, 135, 115, 251, 0, 0, 0, 0], 
                        "note": "*FFB production and rainfall data YTD August 2025."
                    },
                    "ageProfile": {
                        "labels": ["0-3 Yrs (Immature)", "4-7 Yrs (Young Mature)", "8-19 Yrs (Prime)", ">20 Yrs (Old)"],
                        "data": [25.1, 35.5, 20.2, 19.1], 
                        "title": "Tagar 1 - Palm Age Distribution (2025)",
                        "note": "*Source: Agronomy Report 2/2025, Pg. 9."
                    }
                },
                "observations": [
                    "<b>Critical Labour Shortage & Low Productivity:</b> A severe shortage of harvesters is the root cause of widespread delays in harvesting, pruning, and weeding. This directly impacts crop recovery and overall estate maintenance. <span class='observation-ref'>(PA Report, Pg. 11, 41; AR Pg. 15, 63)</span>",
                    "<b>Unsatisfactory Crop Recovery & Yield:</b> Yield is significantly below budget. Harvester shortages lead to intervals >15 days, resulting in over-ripe bunches, uncollected loose fruit, and crop loss, particularly in under-pruned old plantings. <span class='observation-ref'>(PA Report, Pg. 41-42; AR Pg. 15-17, 60)</span>",
                    "<b>Delayed Manuring & Suboptimal Nutrition:</b> The 2025 manuring program is significantly behind schedule (up to 3 months), impacting palm health. Leaf analysis confirms suboptimal Magnesium levels, requiring corrective action. <span class='observation-ref'>(PA Report, Pg. 28; AR Pg. 11-12, 22)</span>",
                    "<b>Poor Upkeep in Young & Immature Areas:</b> Young mature areas suffer from incomplete pruning and weedy conditions. Immature blocks (PR22/K) have overdue basal pruning and weeding, with scout harvesting yet to begin, risking crop loss. <span class='observation-ref'>(PA Report, Pg. 48-51; AR Pg. 38, 47-49)</span>",
                    "<b>Poor Road Conditions:</b> Many roads are in poor condition with ruts, hindering FFB evacuation. The estate's grader is ineffective, and a motor grader is required. <span class='observation-ref'>(PA Report, Pg. 32-33; AR Pg. 17)</span>",
                    "<b>High Cost of Production:</b> The ex-estate cost per tonne is high, driven by the low crop yields and overspending on General Charges. <span class='observation-ref'>(PA Report, Pg. 14, 45)</span>"
                ],
                "reports": {
                     "agronomy": {
                        "Executive Summary": "Yield has shown slight improvement but remains below potential due to unsatisfactory crop recovery in old plantings and suboptimal field upkeep. Manuring and weeding programs are behind schedule. Key issues requiring immediate attention are harvesting delays, pruning backlogs, and poor maintenance in young mature areas. (Source: AR, Pg. 4-7)",
                        "Nutrient Inputs/Progress of Manuring": "Overall progress is unsatisfactory with significant delays of up to three months noted in most programs (NK1, Mixture A, Mixture B). Labour shortages and weather were cited as reasons. Quality of application has room for improvement to avoid 'narrowband' spreading. (Source: AR, Pg. 11-13)",
                        "Agronomic Observation": "Crop recovery is poor due to harvesting intervals exceeding 15 days, leading to over-ripe bunches and crop loss. This is worsened by under-pruned palms in old plantings and poor road conditions. Palm appearance is generally acceptable, but suboptimal Magnesium levels are a concern. Pruning and weeding are behind schedule. Ganoderma was noted in P11. (Source: AR, Pg. 15-34)",
                        "Yield Performance": "As of August 2025, the average yield increased by 3% compared to the previous year, mainly from young mature plantings. However, yields in most old and prime plantings have declined. Crop recovery was not maximized, with less than 16 harvesting rounds completed in most fields. (Source: AR, Pg. 60-63)",
                        "Fertilizer Recommendation": "The 2026 fertilizer program has been formulated. The estate must complete the delayed 2025 program to avoid revisions for 2026. An additional round of kieserite is prescribed for 2026 to address the suboptimal Mg levels. (Source: AR, Pg. 22, 65-67)"
                    },
                    "plantation": {
                        "Executive Summary": "The main issue is a shortage of harvesters and sprayers, leading to low productivity and delays in all major field works. Crop production is unsatisfactory and below budget. Field conditions are currently acceptable but risk deteriorating. Urgent recruitment and improved worker productivity are required. (Source: PA Report, Pg. 59-60)",
                        "Area Statement": "Total planted area is 1,851.0 ha, with 1,382.0 ha mature and 464.0 ha immature. PR21 (243 ha) was recently declared mature. (Source: PA Report, Pg. 10)",
                        "Labour Statement": "The estate is short of 12 harvesters and 7 sprayers. The current worker to land ratio is 1:16 ha, below the ideal 1:14 ha. Recruitment is planned for September/October. (Source: PA Report, Pg. 11-12)",
                        "Staff Establishment": "The staff complement is adequate, with one Field Supervisor resigning in June and another promoted in August. (Source: PA Report, Pg. 13)",
                        "General Charges": "Overspent by 27% YTD July due to unbudgeted Head Office charges for Directors' fees and some staff salaries. (Source: PA Report, Pg. 14)",
                        "Upkeep and Cultivation": "Weeding, manuring, and pruning are all behind schedule due to labour shortages. Road grading is only 46% complete and requires a motor grader for effective work as the current method is unsatisfactory. (Source: PA Report, Pg. 17, 28, 32, 35)",
                        "Harvesting and Collection": "Achieved 12 of 14 budgeted harvesting rounds. Harvester productivity is low, with many working only ~5 hours/day, leading to low average earnings. Supervision is unsatisfactory, with uncollected loose fruits and ripe bunches noted. (Source: PA Report, Pg. 39-41)",
                        "Crop Production": "YTD July yield is 7.70 MT/ha, which is 21% below budget. The shortfall is primarily attributed to the shortage of harvesters. (Source: PA Report, Pg. 42)",
                        "Production Cost": "Cost per tonne (RM 344.80) is higher than budget, driven by low crop yield and overspending on General Charges. (Source: PA Report, Pg. 45)",
                        "Immature PR22/K (180 ha)": "Weeding and basal pruning are behind schedule. Scout harvesting has not yet commenced due to a lack of harvesters, creating a risk of crop loss. (Source: PA Report, Pg. 48-51)",
                        "Immature PR23/L (176 ha)": "Weeding is 73% complete and circles are clean. Manuring is 57% complete. Palm appearance is satisfactory but VOPs need eradication. (Source: PA Report, Pg. 52-55)",
                        "Immature PR24/M (108 ha)": "Palm planting (59 ha) and cover crop planting (65 ha) are in progress but currently on hold due to dry weather. (Source: PA Report, Pg. 56-58)"
                    },
                    "pinfosys": "Not Available"
                },
                "policy": "<p>Policy cross-references are not yet available for this estate.</p>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-red-50 text-red-800' :
                                       metric.title.includes('Manuring') ? 'bg-yellow-50 text-yellow-800' : 'bg-orange-50 text-orange-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (2025)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                             <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#a7f3d0', '#34d399', '#059669', '#065f46'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);
                
                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }

                if (pinfosysDiv && estateData.reports.pinfosys === "Not Available") {
                    pinfosysDiv.innerHTML = `<p class="text-sm text-gray-600">Not Available</p>`;
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const policyData = "<p>Policy cross-references are not yet available for this estate.</p>";
            modalTitle.innerText = `Agricultural Policy Cross-Reference: Ladang Tagar 1`;
            modalContent.innerHTML = policyData;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>

