<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Ladang Darabif & Insan Jaya - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Darabif & Insan Jaya Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "darabif",
                "name": "Ladang Darabif & Insan Jaya Estate",
                "reportInfo": "Data based on PA Report 2-2025 (Visit: Dec 2025) & Agronomy Report 2-2025 (Visit: Sep 2025).",
                "summaryMetrics": {
                    "area": {
                        "title": "Estate Area",
                        "lines": [
                            "Ladang Darabif: 1,647.00 ha",
                            "Ladang Insan Jaya: 483.00 ha",
                            "Total Mature: 2,130.00 ha"
                        ]
                    },
                    "yield": {
                        "title": "Yield/Ha (Actual vs Budget)",
                        "value": "16.93 / 20.30 MT",
                        "note": "Darabif YTD Oct 2025. -17% vs Budget. (PA Rep 2-2025)"
                    },
                    "cost": {
                        "title": "FFB Cost/Tonne (Actual vs Budget)",
                        "value": "RM 202.97 / RM 230.45",
                        "note": "Darabif YTD Oct 2025. Underspent due to delayed upkeep."
                    },
                    "weeding": {
                        "title": "Weeding Progress",
                        "value": "Satisfactory",
                        "note": "Circle Spraying 67%, Selective 91% (Darabif PA Rep 2-2025)"
                    },
                    "manuring": {
                        "title": "Manuring Progress",
                        "value": "Delayed",
                        "note": "Darabif: 74% (YTD Oct). Sub-surface cancelled for broadcasting. (PA Rep 2-2025)"
                    }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio (Darabif)", "value": "1:17 ha (Inadequate)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "Yield Shortfall (Darabif)", "value": "-17% vs Budget" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "21 Days (Darabif)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "Road Status", "value": "Grading Delayed (57%)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Harvest Rounds", "value": "15 vs 20 Budget" }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jan-25", "Feb-25", "Mar-25", "Apr-25", "May-25", "Jun-25", "Jul-25", "Aug-25"],
                        "ffb": [2938, 2915, 2951, 3148, 3650, 4050, 4252, 4017],
                        "rainfall": [202, 61, 202, 311, 433, 127, 21, 168],
                        "note": "*Chart data available up to Aug 2025. Text report updated YTD Oct 2025."
                    },
                    "ageProfile": {
                        "labels": ["8-19 Years", "20-25 Years"],
                        "data": [14.5, 85.5],
                        "title": "Darabif & Insan Jaya Palm Age Distribution",
                        "note": "*Combined weighted age distribution for 2025."
                    }
                },
                "observations": [
                    "<b>Yield Shortfall (Darabif):</b> Production is 17% below budget (16.93 MT/ha YTD Oct) due to persistent harvester shortages earlier in the year and extended intervals. <span class='observation-ref'>(PA Report 2-2025, Pg. 42; Agro Report 2-2025, Pg. 55)</span>",
                    "<b>Harvesting Operations:</b> Intervals remain high at 21 days (Target: 14) for Darabif. Insan Jaya intervals >20 days. Productivity in blocks B, C, and D is low (<2.5 MT/md). <span class='observation-ref'>(PA Report 2-2025, Pg. 38, 41; Agro Report 2-2025, Pg. 37)</span>",
                    "<b>Manuring Delays:</b> Application is significantly behind schedule (74% complete YTD Oct). Sub-surface application was cancelled in favor of broadcasting to catch up. <span class='observation-ref'>(PA Report 2-2025, Pg. 14, 24)</span>",
                    "<b>Infrastructure Issues:</b> Road grading is delayed (57% complete). Specific issues include erosion at P03/C5 and flooding at P03/D4 due to main drain overflow. <span class='observation-ref'>(PA Report 2-2025, Pg. 30)</span>",
                    "<b>Labour Situation:</b> Harvester shortage was critical but reported adequate in Dec 2025. However, spraying workers remain short (-5). High turnover is a major concern. <span class='observation-ref'>(PA Report 2-2025, Pg. 10, 47)</span>",
                    "<b>Pest & Disease:</b> Ganoderma infection is 0.63% at Darabif; deboling is incomplete. Rat damage >10% at Insan Jaya remains a concern. <span class='observation-ref'>(PA Report 2-2025, Pg. 26; Agro Report 2-2025, Pg. 34)</span>"
                ],
                "reports": {
                    "plantation_darabif": {
                        "Executive Summary": "The estate faces a high turnover of harvesters, though the situation improved by December. Yield YTD Oct is 17% below budget. Field conditions are generally satisfactory, but VOPs need eradication. Road grading must be completed in Feb during dry weather. (PA Report 2-2025, Pg. 47)",
                        "Area Statement": "As of Oct 2025, the total planted area is 1,684.00 ha. This comprises:\n• Mature: 1,647.00 ha.\n• Immature: 0 ha.\n• Others: 25 ha Vacant Land, 12 ha Housing/Pond.\n• Issues: 50 ha tapping rights claim (P03/C4, C5, C6, B1) under appeal. (PA Report 2-2025, Pg. 9)",
                        "Labour Statement": "Current workforce is 96 workers vs requirement of 117 (Ratio 1:17 ha).\n• Harvesters: 63 (Shortage: 6, Ratio 1:26 ha). Reported adequate in Dec.\n• Spraying: 9 workers (Shortage: 5).\n• Manuring: 4 workers (Shortage: 5). Reported adequate in Dec.\n• Turnover: High turnover remains a major issue. (PA Report 2-2025, Pg. 10-11)",
                        "Staff Establishment": "Staff establishment is satisfactory with 12 personnel. Includes 1 Manager (Mr. Tomi Hendra), 3 Assistant Managers, and 5 Field Conductors. En. Shafai (Sustainability Exec) resigned in June; En. Amirul (FC) joined in August. (PA Report 2-2025, Pg. 12)",
                        "General Charges": "Total General Charges expenditure is RM 1,373,084.02, which is 30% below the budget. Expenditure is under control. (PA Report 2-2025, Pg. 13)",
                        "Upkeep and Cultivation": "• Weeding: Circle spraying 67% complete (Delayed due to sprayer shortage). Selective spraying 91% complete (Satisfactory). VOPs seen.\n• Manuring: 74% complete (Delayed). Sub-surface application cancelled for blocks P03/A5, C4, C5, D1 due to labor shortage and replaced with broadcasting.\n• Pest & Disease: Ganoderma infection 0.63% (Deboling incomplete). Rat damage low.\n• Roads: Grading 57% complete (979/1719 chains). Erosion noted at P03/C5. Flooding at P03/D4.\n• Drains: Desilting 22% complete (47/219 chains). (PA Report 2-2025, Pg. 14-33)",
                        "Harvesting and Collection": "YTD Cost is RM 71.52/MT, slightly higher than budget (RM 68.88/MT).\n• Rounds: Achieved 15 rounds vs 20 budget.\n• Interval: 21 days (Target 14 days). Needs reduction.\n• Productivity: Low in blocks B, C, D (2.07 - 2.56 MT/md). Needs improvement to 3 MT/md.\n• Loose Fruit: Supervision needs improvement. (PA Report 2-2025, Pg. 38-41)",
                        "Crop Production": "YTD FFB Production is 27,549 MT.\n• Yield/Ha: 16.93 MT/ha, which is 17% below the budget of 20.30 MT/ha.\n• Issues: Shortfall primarily due to harvester shortage and extended intervals. Bunch weights in C & D stagnant due to overripe bunches. (PA Report 2-2025, Pg. 42-43)",
                        "Production Cost": "YTD Cost of Production is RM 202.97/MT, which is favourable compared to the budget of RM 230.45/MT.\n• General Charges: RM 49.84/MT (-16%)\n• Upkeep: RM 70.88/MT (-22%)\n• Harvesting: RM 82.25/MT (+3%) (PA Report 2-2025, Pg. 44)",
                        "Vehicles Running Cost": "Vehicle running costs are satisfactory. Hilux ALM 1918 running cost is RM 0.28/km vs Budget RM 0.74/km. (PA Report 2-2025, Pg. 45)",
                        "Capital Expenditure": "Budget RM 551,560. Actual expenditure is charged to General Charges by Head Office. Includes new labour/staff quarters. (PA Report 2-2025, Pg. 46)",
                        "Immature": "N/A (100% Mature Estate). (PA Report 2-2025, Pg. 9)"
                    },
                    "agronomy": {
                         "Executive Summary":"Palm census by drone is in progress. Manuring programs are deviated from schedule, and applications delayed. Harvesting intervals are extended (>15 days), impacting crop recovery, especially at Darabif. Rat attack at Insan Jaya is 'concerning'. Darabif yield has significantly declined, while Insan Jaya is slightly up but below expectation. Key issues are labour shortage, manuring delays, and extended harvesting intervals. (Agro Report, Pg. 4-7)",
                        "Nutrient Inputs/Progress of Manuring":"Overall progress is below target due to limited manpower. As of Aug 2025, Darabif (Mix B) is 38% complete, and Insan Jaya (Mix B) is 71% complete. Most applications are delayed by ~4 months. Darabif's sub-soil application for 5 blocks had no progress and was changed to broadcasting. Application quality in PM15G-4 was acceptable. (Agro Report, Pg. 12-16)",
                        "Agronomic Observations (Ladang Insan Jaya)":"Harvesting intervals are inconsistent, exceeding 20 days (up to 26 in P15G). Overripe/rotten bunches and uncollected loose fruits observed (Pg. 17-20). Hilly areas (P15G) show N-deficiency symptoms (Pg. 22). Pruning is 68-100% complete, but frond stacking is below standard (Pg. 24, 26). Weeding is effective, but undesirable vegetation and epiphytes (E1/E2) need attention (Pg. 28, 30, 32). Rat damage exceeded the 10% threshold; baiting acceptance remains high, indicating a persistent issue (Pg. 34-35).",
                        "Agronomic Observations (Ladang Darabif)":"Harvesting intervals are not meeting targets (17-22+ days) due to manpower, but crop quality was assessed as acceptable (Pg. 37-38). Palm appearance is acceptable (Pg. 40). Pruning is 71-100% complete, but slow in PM03D. Slight under-pruning noted (P03A/P03D) (Pg. 42). Frond stacking is not satisfactory (Pg. 45). Weeding is satisfactory (84-116% complete) (Pg. 48-49). Rat damage is within the acceptable threshold (3.9-5.0%) (Pg. 53).",
                        "Yield Performance":"Darabif: Average yield is 12.86 mt/ha, a 13% decline vs 2024 (as of Aug 2025), due to manpower limits and manuring delays. Harvesting rounds are 69-87% of target (Pg. 55-56). Insan Jaya: Average yield is 14.32 mt/ha, a 1% increase vs 2024. Performance is varied by block. Harvesting rounds are only 41-54% of target (Pg. 57-58). Key limiting factors for both estates are labour shortage and delayed fertilizer application (Pg. 59).",
                        "Fertilizer Recommendation":"Manuring progress for 2025 is unsatisfactory. The 2026 fertilizer program has been outlined in Appendix 2. (Agro Report, Pg. 60)"
                    },
                    "plantation_insanjaya": {
                        "Note": "Data below is retained from Report 1-2025. No new report available.",
                        "Executive Summary":"Main issues are production-related, stemming from harvester (-4) and manuring worker (-1) shortages. This has led to delayed field work (manuring 46% complete) and a 13% yield shortfall vs budget (as of May). Road maintenance is critical. (PA Report 1-2025, Pg. 10, 21, 36, 43)",
                        "Area Statement":"Total planted area is 483.00 ha, all mature. No change in area statement. (PA Report 1-2025, Pg. 8)",
                        "Labour Statement":"Total 29 workers. The estate is short 4 harvesters and 1 manuring worker. The ratio of workers to planted ha is 1:15, which is acceptable. (PA Report 1-2025, Pg. 9-10)",
                        "Upkeep & Cultivation":"Circle spraying (R1) is 104% complete and satisfactory. Manuring is severely behind schedule at 46% complete (as of May) due to worker shortage. Pruning is 60% complete. Rat damage is high at 12.8%; baiting commenced in June. (PA Report 1-2025, Pg. 14, 21, 23, 26, 28, 30)",
                        "Harvesting and Collection":"Harvesting rounds are very low (6.19 vs. 10 budget) with an average interval of 19 days. Harvester productivity was low but improved significantly in June. (PA Report 1-2025, Pg. 32, 34, 35)",
                        "Crop Production":"Yield YTD May is 7.12 tons/ha, which is 13% below budget (8.15 tons/ha). (PA Report 1-2025, Pg. 36)"
                    },
                    "pinfosys": {
                         "CEO Financial Summary": "N/A",
                        "Summary of Oil Palm Expenditure": "N/A"
                    }
                },
                "policy": "<div class='policy-item'><p class='font-semibold'>Labour Recruitment & Productivity</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> High turnover of harvesters must be curbed by encouraging high wages through productivity and long-term retention strategies. (PA Rep 2-2025, Pg. 47)</p></div><div class='policy-item'><p class='font-semibold'>Field Operations & Upkeep</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> Road grading and surfacing must be done in February to capitalise on dry weather. (PA Rep 2-2025, Pg. 47)</p><p class='text-sm text-gray-600'><b>Agro Report Remark:</b> Manuring was deviated from the schedule... Do not allow further delay in manuring. (Agro Rep 2-2025, Pg. 4, 7)</p></div><div class='policy-item'><p class='font-semibold'>Harvesting Standards</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> To achieve the production budget, the estate must achieve a minimum of 24 rounds/year. Productivity for blocks B, C, and D needs improvement. (PA Rep 2-2025, Pg. 47)</p></div><div class='policy-item'><p class='font-semibold'>Pest & Disease Control</p><p class='text-sm text-gray-600'><b>Agro Report Remark (Insan Jaya):</b> Rat attack is concerning. Rat Baiting has deviated from the standard... ensure... activities are conducted in accordance with the standard operational guidelines. (Agro Rep 2-2025, Pg. 5, 35)</p></div>"
            };

            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate();
                    populateInternalDropdowns();
                    attachEventListeners();
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-orange-50 text-orange-800' :
                                       metric.title.includes('Weeding') ? 'bg-yellow-50 text-yellow-800' : 'bg-purple-50 text-purple-800';
                    
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass} h-full"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm text-gray-700">${line}</p>`).join('')}</div>`;
                    }
                    
                    return `<div class="p-4 rounded-lg ${colorClass} h-full"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold text-gray-900 mt-2">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="flex-shrink-0 bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div>
                            <p class="text-sm text-gray-500">${metric.label}</p>
                            <p class="font-bold text-lg">${metric.value}</p>
                        </div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall (2025)</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details (Report 2-2025)</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-plantation-darabif" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details (Darabif, Report 2-2025)</button>
                            <div id="${estate.id}-plantation-darabif" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-plantation-insanjaya" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details (Insan Jaya, Report 1-2025)</button>
                            <div id="${estate.id}-plantation-insanjaya" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#c026d3', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#4CAF50', '#2196F3', '#FFC107', '#F44336', '#9C27B0'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDarabifDiv = document.getElementById(`${estateData.id}-plantation-darabif`);
                const plantationInsanJayaDiv = document.getElementById(`${estateData.id}-plantation-insanjaya`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);

                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDarabifDiv && estateData.reports.plantation_darabif) {
                    plantationDarabifDiv.innerHTML = Object.entries(estateData.reports.plantation_darabif).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationInsanJayaDiv && estateData.reports.plantation_insanjaya) {
                    plantationInsanJayaDiv.innerHTML = Object.entries(estateData.reports.plantation_insanjaya).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                 if (pinfosysDiv && estateData.reports.pinfosys) {
                    pinfosysDiv.innerHTML = Object.entries(estateData.reports.pinfosys).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', () => openPolicyModal(estateData));
            }

            renderEstate();
        });
        
        function openPolicyModal(estateData) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estateData.name}`;
            modalContent.innerHTML = estateData.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
