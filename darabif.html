<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ladang Darabif & Insan Jaya - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #4a5568; }
        .policy-item { border-left: 3px solid #6366f1; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Ladang Darabif & Insan Jaya Report
                </a>
            </div>
            <a href="estates.html" class="text-indigo-600 hover:text-indigo-800 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id":"darabif",
                "name":"Ladang Darabif & Insan Jaya Estate",
                "reportInfo":"Data based on Agronomy Report 1-2025, Darabif PA Report 1-2025, and Insan Jaya PA Report 1-2025.",
                "summaryMetrics":{
                    "area":{"title":"Estate Area","lines":["Ladang Insan Jaya: 483.00 ha Mature","Ladang Darabif: 1,647.00 ha Mature","Total: 2,130.00 ha"]},
                    "yield":{"title":"Yield/Ha (Darabif)","value":"7.47 MT","note":"-14% vs Budget (as of May 2025)"},
                    "cost":{"title":"FFB Cost/Tonne (Darabif)","value":"RM 199.19","note":"As of May 2025"},
                    "weeding":{"title":"Weeding Progress (Darabif)","value":"On Schedule","note":"R1 Circle Spraying Complete"},
                    "manuring":{"title":"Manuring Progress (Combined)","value":"Behind Schedule","note":"Darabif: 71%, Insan Jaya: 46%"}
                },
                "keyMetrics":[
                    {"icon":"<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>","label":"Harvester Shortage","value":"Darabif: -16, Insan Jaya: -4"},
                    {"icon":"<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283-.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>","label":"Worker Shortage","value":"Sprayers & Manuring Staff"},
                    {"icon":"<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>","label":"Yield Shortfall","value":"Both Estates vs Budget/Last Year"},
                    {"icon":"<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>","label":"Harvest Interval","value":"Darabif: 23 days, Insan Jaya: 19 days"},
                    {"icon":"<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>","label":"Roads","value":"Grading & Surfacing Delayed"},
                    {"icon":"<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>","label":"P&D Status","value":"Minimal Rat, Ganoderma Monitored"}
                ],
                "chartData":{
                    "production":{"labels":["Jan-24","Feb-24","Mar-24","Apr-24","May-24","Jun-24","Jul-24","Aug-24","Sep-24","Oct-24","Nov-24","Dec-24"],"ffb":[3100,3900,3450,3400,4800,4550,4450,4650,4950,4400,3600,3300],"rainfall":[607,32,60,95,111,88,34,139,120,358,449,0],"note":"*Combined FFB production and average rainfall for 2024."},
                    "ageProfile":{"labels":["8-19 Years","20-25 Years"],"data":[14.5,85.5],"title":"Darabif & Insan Jaya Palm Age Distribution","note":"*Combined weighted age distribution for 2025."}
                },
                "observations":[
                    "<b>Severe Labour Shortage (Both):</b> Both estates are critically short of workers, especially harvesters (-16 at Darabif, -4 at Insan Jaya), directly impacting all field operations. Recruitment is the top priority. (Darabif PA, Pg. 10-11; Insan Jaya PA, Pg. 9-10)",
                    "<b>Significant Yield Shortfall (Both):</b> Both estates report yields well below budget and last year's performance, a direct result of harvester shortages and extended harvesting intervals (Darabif: 23 days, Insan Jaya: 19 days). (Darabif PA, Pg. 34, 37; Insan Jaya PA, Pg. 32, 36)",
                    "<b>Delayed Field Work (Both):</b> Manuring programs are behind schedule on both estates. Road grading and surfacing are also delayed and must be completed before the monsoon. (Darabif PA, Pg. 23, 28; Insan Jaya PA, Pg. 21, 30)",
                    "<b>Low Harvester Productivity (Darabif):</b> Despite using machines, Darabif's harvester productivity is low and needs to improve to at least 3 tons/man-day. (Darabif PA, Pg. 35)",
                    "<b>Harvesting Quality Issues (Both):</b> Uncollected loose fruit and harvested bunches were observed at both estates, indicating a need for tighter supervision. (Darabif PA, Pg. 36; Insan Jaya PA, Pg. 34)",
                    "<b>Land Tapping Issue (Darabif):</b> An ongoing land tapping claim by a cooperative is interrupting activities on 30 ha of the estate. (Darabif PA, Pg. 9)"
                ],
                "reports":{
                    "agronomy":{
                        "Executive Summary":"Palm census data has not been updated since 2019. Manuring programs experienced delays, and application quality needs improvement. Harvesting intervals are extended, leading to inconsistent crop quality and over-ripe bunches, though loose fruit collection has improved. Canopy management is generally acceptable, but under-pruning and inconsistent frond stacking were observed. Weeding programs are slightly delayed, with undesirable weeds present and some over-spraying. Rat infestation is minimal, and Ganoderma infection is being monitored. Yield performance for Jan-Feb 2025 is significantly lower due to seasonal factors, and road conditions are a concern for crop evacuation. Fertilizer recommendations remain unchanged. (Agronomy Report, Pg. 4-6)",
                        "Nutrient Inputs/Progress of Manuring":"The 2024 manuring program was completed for Ladang Darabif, and 97% completed for Ladang Insan Jaya due to adverse weather and labor shortage. Delays of 3-5 months were observed in 2024. For 2025, Ladang Darabif is 17% complete and Ladang Insan Jaya is 8% complete as of Feb 2025, progressing slower than expected. Fertilizer delivery is also slower than scheduled. Application quality needs improvement (narrow and lumpy application observed). The fertilizer store is acceptable. (Agronomy Report, Pg. 4, 12-14, 16)",
                        "Agronomic Observations (Ladang Insan Jaya)":"Harvesting intervals are mostly exceeding 20 days, leading to significant over-ripe and rotten bunches. FFB were left overnight in some areas. Loose fruit collection is generally acceptable. Palm appearance is acceptable, but retarded growth and small bunch formation observed in some areas. Pruning is progressing well, but under-pruning and pre-mature frond snapping were observed. Frond heap management is inconsistent. Weeding program is behind schedule for circle spraying. Undesirable weeds are present. Rat damage is minimal. Ganoderma symptoms require deboling. (Agronomy Report, Pg. 17-18, 21, 24-25, 29-31)",
                        "Agronomic Observations (Ladang Darabif)":"Harvesting intervals are extended in most blocks. Crop quality is unsatisfactory with under-ripe and significant over-ripe/unfresh bunches observed. Palm appearance is generally acceptable, but less vigor in flood-prone areas. Pruning progress for 2025 is not yet reported, with some under-pruning and pre-matured frond snapping. Inconsistent frond stacking and need for roadside pruning. Inter-row spraying is progressing well, but circle weeding is slower than expected. VOPs and Epiphytes need eradication. Rat infestation is minimal. Ganoderma infection remains under control. (Agronomy Report, Pg. 36-37, 41-43, 45-47)",
                        "Yield Performance":"Yields in 2024 were significantly higher than the previous year for both estates. However, crop recovery was not maximized due to less than 24 harvesting rounds. For Jan-Feb 2025, cumulative yields declined significantly (-23% for Darabif, -19% for Insan Jaya) due to seasonal factors. Road maintenance is a concern for crop evacuation. (Agronomy Report, Pg. 51-52, 54)",
                        "Fertilizer Recommendation":"The 2025 fertilizer program remains unchanged. The 2026 program will be developed after the next agronomy report. (Agronomy Report, Pg. 55)"
                    },
                    "plantation_darabif":{
                        "Executive Summary":"The primary issues are a severe shortage of harvesters and field workers, causing a 14% yield shortfall and delaying manuring. Harvester productivity is low despite mechanization. Field upkeep is satisfactory, but road surfacing is urgent. (PA Report, Pg. 42-43)",
                        "Area Statement":"Total mature area is 1,647.00 ha. A tapping rights claim affects 30 ha. Block P05/E2 (20 ha) is managed by Insan Jaya. (PA Report, Pg. 9)",
                        "Labour Statement":"The estate is short of 16 harvesters, 5 spraying workers, and 4 manuring workers. Recruitment is planned for July. (PA Report, Pg. 10-11)",
                        "Staff Establishment":"Significant staff changes have occurred. Current staff is adequate. (PA Report, Pg. 12-13)",
                        "General Charges":"Spending is 30% under budget and under control. (PA Report, Pg. 14)",
                        "Upkeep & Cultivation":"Circle spraying is complete (R1). Manuring is 71% complete but behind schedule. Pruning is on schedule. P&D is minimal. Road works are delayed. (PA Report, Pg. 15)",
                        "Harvesting and Collection":"Costs are acceptable, but rounds are behind budget (8 vs. 10) with a 23-day interval. Harvester productivity is low. (PA Report, Pg. 34-35)",
                        "Crop Production":"Yield is 7.47 tons/ha, 14% below budget and 22% below last year, due to harvester shortage. (PA Report, Pg. 37)",
                        "Production Cost":"FFB cost is RM 199.19 per tonne, which is acceptable. (PA Report, Pg. 39)",
                        "Vehicles Running Cost":"Budgeting is required for two vehicles next year. (PA Report, Pg. 40)",
                        "Capital Expenditure":"No budget for Capital Expenditure. (PA Report, Pg. 41)",
                        "Immature":"N/A"
                    },
                    "plantation_insanjaya":{
                        "Executive Summary":"Main issues are production-related, from harvester/manuring worker shortages, leading to delayed work and a 13% yield shortfall. Road maintenance is critical. (PA Report, Pg. 43)",
                        "Area Statement":"Total planted area is 483.00 ha, all mature. (PA Report, Pg. 8)",
                        "Labour Statement":"The estate is short of 4 harvesters and 1 manuring worker. Recruitment is planned for July. (PA Report, Pg. 9-10)",
                        "Staff Establishment":"Staffing is adequate; new Field Conductors require training. (PA Report, Pg. 11)",
                        "General Charges":"39% under budget, but recruitment expenses are overspent by 1300%. (PA Report, Pg. 12)",
                        "Upkeep & Cultivation":"Circle spraying is on schedule. Manuring is behind (46% complete). Pruning is 60% complete with some quality issues. (PA Report, Pg. 13)",
                        "Harvesting and Collection":"Costs are acceptable, but rounds are very low (6.19 vs 10 budget) with a 19-day interval due to harvester shortage. (PA Report, Pg. 32)",
                        "Crop Production":"Yield is 7.12 tons/ha, 13% below budget and 10% below last year. (PA Report, Pg. 36)",
                        "Production Cost":"FFB cost is RM 184.15 per tonne, which is acceptable. (PA Report, Pg. 40)",
                        "Vehicles Running Cost":"Vehicle running cost is acceptable. (PA Report, Pg. 41)",
                        "Capital Expenditure":"No capital expenditure budgeted. (PA Report, Pg. 42)",
                        "Immature":"N/A"
                    },
                    "pinfosys": {
                        "CEO Financial Summary": "N/A",
                        "Summary of Oil Palm Expenditure": "N/A"
                    }
                },
                "policy":"<div class='policy-item'><p class='font-semibold'>Labour Recruitment & Productivity</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> The estate was short of harvesters and field workers... More efforts to recruit workers to cover the shortage must be endeavoured. (Pg. 42)</p><p class='text-sm text-gray-600'><b>Insan Jaya PA Remark:</b> The estate must endeavour to recruit adequate harvesters and workers for manuring. (Pg. 43)</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> To increase harvesters' productivity, as this estate had high crop potential. To bring down the extended harvesting intervals as soon as possible. (Pg. 43)</p></div><div class='policy-item'><p class='font-semibold'>Field Operations & Upkeep</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> It is imperative that the estate complete the manuring program for this financial year. (Pg. 42)</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> Ensure all field roads are in good condition and complete surfacing with crusher runs before the monsoon season sets in. (Pg. 42)</p><p class='text-sm text-gray-600'><b>Insan Jaya PA Remark:</b> The main issues to be the focus will be on production and well-maintained roads. (Pg. 43)</p></div><div class='policy-item'><p class='font-semibold'>Pest & Disease Control</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> Continue monitoring rat damage and Ganoderma infestations. (Pg. 42)</p><p class='text-sm text-gray-600'><b>Insan Jaya PA Remark:</b> To carry out 2 rounds of rat baiting initially... To commence a census regarding Ganoderma infestations and carry out deboling at the base of fallen palms. (Pg. 43)</p></div>"
            };

            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate();
                    populateInternalDropdowns();
                    attachEventListeners();
                }, 0);
            }

            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-red-50 text-red-800' :
                                       metric.title.includes('Weeding') ? 'bg-yellow-50 text-yellow-800' : 'bg-purple-50 text-purple-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-plantation-darabif" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details (Darabif)</button>
                            <div id="${estate.id}-plantation-darabif" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-plantation-insanjaya" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details (Insan Jaya)</button>
                            <div id="${estate.id}-plantation-insanjaya" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#c026d3', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#4CAF50', '#2196F3', '#FFC107', '#F44336', '#9C27B0'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDarabifDiv = document.getElementById(`${estateData.id}-plantation-darabif`);
                const plantationInsanJayaDiv = document.getElementById(`${estateData.id}-plantation-insanjaya`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);

                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDarabifDiv && estateData.reports.plantation_darabif) {
                    plantationDarabifDiv.innerHTML = Object.entries(estateData.reports.plantation_darabif).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationInsanJayaDiv && estateData.reports.plantation_insanjaya) {
                    plantationInsanJayaDiv.innerHTML = Object.entries(estateData.reports.plantation_insanjaya).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                 if (pinfosysDiv && estateData.reports.pinfosys) {
                    pinfosysDiv.innerHTML = Object.entries(estateData.reports.pinfosys).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const estateData = {
                "id":"darabif",
                "name":"Ladang Darabif & Insan Jaya Estate",
                "policy":"<div class='policy-item'><p class='font-semibold'>Labour Recruitment & Productivity</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> The estate was short of harvesters and field workers... More efforts to recruit workers to cover the shortage must be endeavoured. (Pg. 42)</p><p class='text-sm text-gray-600'><b>Insan Jaya PA Remark:</b> The estate must endeavour to recruit adequate harvesters and workers for manuring. (Pg. 43)</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> To increase harvesters' productivity, as this estate had high crop potential. To bring down the extended harvesting intervals as soon as possible. (Pg. 43)</p></div><div class='policy-item'><p class='font-semibold'>Field Operations & Upkeep</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> It is imperative that the estate complete the manuring program for this financial year. (Pg. 42)</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> Ensure all field roads are in good condition and complete surfacing with crusher runs before the monsoon season sets in. (Pg. 42)</p><p class='text-sm text-gray-600'><b>Insan Jaya PA Remark:</b> The main issues to be the focus will be on production and well-maintained roads. (Pg. 43)</p></div><div class='policy-item'><p class='font-semibold'>Pest & Disease Control</p><p class='text-sm text-gray-600'><b>Darabif PA Remark:</b> Continue monitoring rat damage and Ganoderma infestations. (Pg. 42)</p><p class='text-sm text-gray-600'><b>Insan Jaya PA Remark:</b> To carry out 2 rounds of rat baiting initially... To commence a census regarding Ganoderma infestations and carry out deboling at the base of fallen palms. (Pg. 43)</p></div>"
            };
            modalTitle.innerText = `Agricultural Policy Cross-Reference: ${estateData.name}`;
            modalContent.innerHTML = estateData.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
