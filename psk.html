<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSK Estate - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #4a5568; }
        .policy-item { border-left: 3px solid #6366f1; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    PSK Estate Report
                </a>
            </div>
            <a href="estates.html" class="text-indigo-600 hover:text-indigo-800 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            const estateData = {
                "id": "psk",
                "name": "PSK Estate",
                "reportInfo": "Data based on Agronomy Report (1/2025) and PA Report (2/2025, visit on 6th August 2025).",
                "summaryMetrics": {
                    "area": { "title": "Estate Area", "lines": ["Mature: 1,999.83 ha", "Immature: 0.00 ha", "Total: 1,999.83 ha"] },
                    "yield": { "title": "Yield/Ha (Actual vs Budget)", "value": "5.45 / 8.03 MT", "note": "YTD June 2025" },
                    "cost": { "title": "FFB Cost/Tonne (Actual vs Budget)", "value": "RM 260.60 / RM 340.06", "note": "YTD June 2025" },
                    "weeding": { "title": "Weeding Progress (YTD June 2025)", "value": "Circle: 39%, Selective: 57%", "note": "Delayed due to flooding & sprayer shortage" },
                    "manuring": { "title": "Manuring Progress (YTD June 2025)", "value": "33%", "note": "Delayed due to flooding" }
                },
                "keyMetrics": [
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Labour Ratio", "value": "1:33 ha (Short 23 Harvesters)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-green-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>", "label": "P&D Status", "value": "Rat Damage at 1%" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>", "label": "OER %", "value": "15.82% (Actual)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' /></svg>", "label": "Harvester Prod.", "value": "1.7-2.0 MT/md" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>", "label": "Harvest Interval", "value": "16 days (Avg)" },
                    { "icon": "<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 18.343A8 8 0 016.343 7.029m11.314 11.314a8 8 0 01-11.314-11.314m2.121 13.435a2 2 0 01-2.828 0l-2.122-2.121a2 2 0 010-2.828l5.656-5.657a2 2 0 012.829 0l2.121 2.121a2 2 0 010 2.828l-5.657 5.657z' /></svg>", "label": "Nutrient Status", "value": "Suboptimal (Mg Deficiency)" }
                ],
                "chartData": {
                    "production": { "labels": ["Jan-25", "Feb-25", "Mar-25", "Apr-25", "May-25", "Jun-25", "Jul-25", "Aug-25", "Sep-25", "Oct-25", "Nov-25", "Dec-25"], "ffb": [10903.58, 0, 0, 0, 0, 0, 16051, 16051, 16051, 16051, 16051, 16051], "rainfall": [1485, 51, 103, 153, 85, 180, 75, 128, 187.5, 321, 554, 448], "note": "*FFB data from Jan-Jun 2025 is actual, rest is budget. Rainfall from previous PA report." },
                    "ageProfile": { "labels": ["0-3 Years", "4-7 Years", "8-19 Years", "20-25 Years", ">26 Years"], "data": [0.12, 0, 82.8, 16.28, 0], "title": "PSK Estate Palm Age Distribution (ha)", "note": "*83% of palms are in prime age category (8-19 years)." }
                },
                "observations": [
                    "<b>Critical Labour Shortage:</b> The estate is short of 23 harvesters and 15 sprayers, the root cause of high worker turnover, low productivity, and significant delays in all major field operations. (PA Report, Pg. 10, 50)",
                    "<b>Delayed Field Work & Pruning Backlog:</b> Due to labour shortages and flooding, manuring is only 33% complete, and a critical corrective pruning backlog of 1,298 ha exists, directly impacting harvesting and palm health. (PA Report, Pg. 29, 30; Agronomy Report, Pg. 11, 26)",
                    "<b>Low Crop Production:</b> YTD yield is 5.45 MT/ha (32% below budget), a direct consequence of the harvester shortage, extended harvesting intervals, and incomplete loose fruit collection noted in both reports. (PA Report, Pg. 44; Agronomy Report, Pg. 48-50)",
                    "<b>Poor Weeding & VOP Infestation:</b> Weeding is slow (Circle 39%, Selective 57%), with low-lying areas heavily infested with VOPs and Stenochlaena, which will compete for nutrients and hinder access. (PA Report, Pg. 16, 20, 50; Agronomy Report, Pg. 34)",
                    "<b>Low Worker Productivity and Wages:</b> Low productivity in spraying and harvesting has led to earnings below the basic wage, fueling high worker turnover and making it difficult to resolve the labour shortage. (PA Report, Pg. 10, 16, 21, 42)",
                    "<b>Unsatisfactory Palm Health:</b> The agronomy report noted unsatisfactory palm vigor, especially in peat areas with signs of Magnesium deficiency, exacerbated by incomplete fertilizer applications. (Agronomy Report, Pg. 15, 23)"
                ],
                "reports": {
                    "agronomy": {
                        "Executive Summary": "Palm census is progressing slower than expected. The 2024 manuring program was incomplete and 2025 progress is slow. Crop recovery is unsatisfactory due to prolonged harvesting intervals and incomplete loose fruit collection, leading to significant over-ripe bunches. Palm nutrient status is suboptimal, and pruning remains a major issue. Weed control is slow, and rat infestation is high with insufficient baiting. (Agronomy Report, Pg. 4-6)",
                        "Nutrient inputs/progress of manuring": "Only 67% of the 2024 manuring program was completed due to flooding and late fertilizer deliveries (Pg. 11). As of March 2025, only 5% of the first half's program is complete, with delays in receiving fertilizers (Pg. 13). The fertilizer store has a leaking roof, risking quality and causing caking (Pg. 15). EFB application was only completed on 20% of the designated area in 2024 (Pg. 14).",
                        "Agronomic observation": "Harvesting intervals frequently exceeded 15 days in 2024, leading to over-ripe and rotten bunches (Pg. 17). Palm appearance is unsatisfactory, especially in peat soil areas, with yellowing and premature frond snapping (Pg. 23). Pruning is significantly behind schedule (only 1% completed in Feb 2025), hindering harvesting (Pg. 26). Weed control is slow, with undesirable grasses and broadleaf weeds present (Pg. 34). Rat damage is high (over 10% in many blocks) with insufficient baiting and poor barn owl box maintenance (Pg. 43-44).",
                        "Yield performance": "Yield in 2024 increased by only 1% vs 2023, remaining below the regional trend (Pg. 47). For Jan-Feb 2025, yield improved by 22% vs last year, though some blocks declined. Low production is caused by extended harvesting intervals (only 67% of target rounds achieved), harvester shortage, low harvester productivity (1.10-1.40 MT/md), incomplete fertilizer programs, and low average bunch weight (11.05 kg) (Pg. 48-50).",
                        "Fertilizer recommendation": "No amendments to the 2025 fertilizer program are recommended. The estate is advised to expedite application immediately after the rainy season and ensure proper drainage to prevent waterlogging. (Pg. 51)"
                    },
                    "plantation": {
                        "Executive Summary": "The estate faces a critical shortage of 23 harvesters and 15 sprayers, leading to high turnover and low wages. Priority must be given to clearing Volunteer Oil Palms (VOPs) and Stenochlaena in low-lying areas. A task force is urgently needed to complete a significant corrective pruning backlog by October. Harvester productivity needs to be increased. (PA Report, Pg. 50-51)",
                        "Area statement": "Total mature planted area is 1,999.83 ha. There has been no change in the area statement. (PA Report, Pg. 9)",
                        "Labour Statement": "A critical shortage of 23 harvesters (actual ratio 1:33 ha vs. 1:24 ha required) and 15 sprayers exists. The overall worker to land ratio is 1:25 ha, indicating a severe shortage. (PA Report, Pg. 10-11)",
                        "Staff Establishment": "The staff establishment is considered sufficient, with 1 manager, 3 executives, 5 field staff, and 2 clerks. However, the majority of staff are inexperienced, having been on the estate for less than 3 years. (PA Report, Pg. 12-13)",
                        "General Charges": "Expenditure was underspent by 49% as of June and is considered under control. (PA Report, Pg. 14)",
                        "Upkeep Cultivation": "Circle spraying is 39% complete and selective spraying is 57% complete, both delayed by flooding and sprayer shortages (Pg. 16, 20). The manuring program is only 33% complete due to flooding (Pg. 29). A significant corrective pruning backlog of 1,298 ha exists, with only 13% of the annual program done (Pg. 30).",
                        "Harvesting and Collection": "The harvesting cost was RM 78.90/tonne. The average harvesting interval was 16 days, with only 9 out of 12 budgeted rounds completed. Harvester productivity is between 1.7 to 2.0 tons/man-day. (PA Report, Pg. 41-42)",
                        "Crop Production": "Yield achieved was 5.45 ton/ha as of June, 32% below budget. The shortfall is due to flooding and harvester shortage. (PA Report, Pg. 44)",
                        "Production Cost": "The cost of production was RM 260.60/tonne FFB. This is acceptable as it's due to underspending in General Charges and Upkeep. (PA Report, Pg. 47)",
                        "Vehicles Running Cost": "The Vehicle Running Account for the Hilux was satisfactory. (PA Report, Pg. 48)",
                        "Capital Expenditure": "Capital expenditure was underspent as of June. (PA Report, Pg. 49)",
                        "Immature": "N/A (0.00 ha of immature palms). (PA Report, Pg. 9)"
                    }
                },
                "policy": " <div class='policy-item'><p class='font-semibold'>Harvester Productivity & Crop Recovery</p><p class='text-sm text-gray-600'><b>Policy 12.6:</b> Maintain high harvesting standards; collect all loose fruits. (Pg. 128)</p><p class='text-sm text-gray-600'><b>Policy 12.3:</b> Ideal harvesting interval 10-12 days. (Pg. 127)</p></div> <div class='policy-item'><p class='font-semibold'>Delayed Manuring Program</p><p class='text-sm text-gray-600'><b>Policy 8.4.1 A:</b> Ensure timely fertilizer application, avoiding heavy/low rainfall periods; proper planning. (Pg. 82-83)</p></div> <div class='policy-item'><p class='font-semibold'>Pruning Backlog & Canopy Management</p><p class='text-sm text-gray-600'><b>Policy 11.01:</b> Pruning is for practical purposes; avoid over-pruning. (Pg. 124)</p><p class='text-sm text-gray-600'><b>Policy 11.1.2 a:</b> Retain two fronds below lowest bunches. (Pg. 124)</p><p class='text-sm text-gray-600'><b>Policy 11.3:</b> Stack pruned fronds neatly in inter-lines. (Pg. 125)</p></div> <div class='policy-item'><p class='font-semibold'>High Rat Damage</p><p class='text-sm text-gray-600'><b>Policy 9.1.3 iii:</b> Conduct regular rat baiting if damage >5%. (Pg. 118)</p><p class='text-sm text-gray-600'><b>Policy 9.1.3 i:</b> Encourage barn owls; use warfarin baits if needed. (Pg. 120)</p></div>"
            };


            // --- GLOBAL VARIABLES ---
            let chartInstances = {}; // To keep track of created charts for proper destruction
            const container = document.getElementById('selected-estate-container');

            // --- FUNCTIONS ---

            /**
             * Renders the full report for the estate.
             */
            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                
                // Use a short timeout to ensure the DOM is updated before initializing charts and events
                setTimeout(() => {
                    initializeChartsForEstate(estateData);
                    populateInternalDropdowns(estateData);
                    attachEventListeners(estateData);
                }, 0);
            }

            /**
             * Creates the HTML string for the estate's report.
             * @param {object} estate - The data object for a single estate.
             * @returns {string} The complete HTML for the estate's report view.
             */
            function createEstateHTML(estate) {
                const summaryMetricsHTML = Object.values(estate.summaryMetrics).map(metric => {
                    const colorClass = metric.title.includes('Area') ? 'bg-blue-50 text-blue-800' : 
                                       metric.title.includes('Yield') ? 'bg-green-50 text-green-800' :
                                       metric.title.includes('Cost') ? 'bg-red-50 text-red-800' :
                                       metric.title.includes('Weeding') ? 'bg-yellow-50 text-yellow-800' : 'bg-purple-50 text-purple-800';
                    if (metric.lines) {
                        return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3>${metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('')}</div>`;
                    }
                    return `<div class="p-4 rounded-lg ${colorClass}"><h3 class="font-semibold">${metric.title}</h3><p class="text-2xl font-bold">${metric.value}</p><p class="text-xs text-gray-500 mt-1">${metric.note}</p></div>`;
                }).join('');

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            /**
             * Initializes charts for the estate.
             */
            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#c026d3', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCtx] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#E5E7EB', '#60A5FA', '#10B981', '#F59E0B', '#EF4444'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            /**
             * Populates the content of the collapsible report sections.
             */
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);

                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy)
                        .map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv && estateData.reports.plantation) {
                    plantationDiv.innerHTML = Object.entries(estateData.reports.plantation)
                        .map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
            }

            /**
             * Attaches event listeners for dropdowns and modal buttons.
             */
            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        const isActive = content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active', isActive);
                    });
                });

                container.querySelector('.policy-modal-btn')?.addEventListener('click', () => {
                    openPolicyModal(estateData);
                });
            }


            // --- INITIALIZATION ---
            renderEstate();
        });
        
        /**
         * Opens the policy modal with data from the estate.
         */
        function openPolicyModal(estateData) {
            document.getElementById('modalTitle').innerText = `Agricultural Policy Cross-Reference: ${estateData.name}`;
            document.getElementById('modalContent').innerHTML = estateData.policy;
            document.getElementById('policyModal').classList.add('active');
        }

        /**
         * Closes the policy modal.
         */
        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>
