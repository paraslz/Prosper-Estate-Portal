<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Sungai Pertang Estate - Plantation and Agronomy Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .details-content { display: none; }
        .details-content.active { display: block; }
        .dropdown-btn.active { background-color: #14532d; }
        .policy-item { border-left: 3px solid #16a34a; padding-left: 1rem; margin-top: 0.75rem; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chart-container { position: relative; height: 300px; width: 100%; margin: auto; }
        .pie-chart-container { position: relative; height: 350px; width: 100%; margin: auto; }
        .observation-ref { font-size: 0.75rem; color: #57534e; font-style: italic; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="text-xl font-bold text-gray-900">
                <a href="index.html" class="flex items-center">
                    Sungai Pertang Estate Report
                </a>
            </div>
            <a href="estates.html" class="text-green-800 hover:text-green-900 transition duration-300">&larr; Back to Estates List</a>
        </nav>
    </header>

    <!-- Main container for the report -->
    <div class="container mx-auto p-4 md:p-8">
        <!-- Container where the estate data will be rendered -->
        <div id="selected-estate-container" class="grid grid-cols-1 gap-8">
             <!-- Content will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal for displaying policy details -->
    <div id="policyModal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-2xl font-bold">Agricultural Policy Cross-Reference</h3>
                <button onclick="closePolicyModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modalContent" class="space-y-4 overflow-y-auto pr-4 flex-grow">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main script for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE ---
            // This data is a synthesis of the Agronomy Report (AR) and the Plantation Advisory Report (PA).
            const estateData = {
                "id": "sgpertang",
                "name": "Ladang Sungai Pertang",
                "reportInfo": "Data based on Agronomy Report 1/2025 (Visit: 13th August 2025) and Plantation Advisory Report 1/2025 (Visit: 9th October 2025).",
                "summaryMetrics": {
                    "area": { 
                        "title": "Estate Area (PA)", 
                        "lines": [
                            "Total Oil Palm: 1,228.00 ha", 
                            "Mature: 1,030.00 ha", 
                            "Immature: 100.00 ha", 
                            "Replanting: 98.00 ha"
                        ],
                        "note": "Source: PA Pg. 5"
                    },
                    "yield": { 
                        "title": "Yield/Ha (Actual vs Estimate)", 
                        "value": "6.60 / 6.17 MT", 
                        "note": "To-Date (21 Jun - 30 Sep 2025). Source: PA Pg. 28" 
                    },
                    "cost": { 
                        "title": "FFB Cost/Tonne", 
                        "value": "N/A", 
                        "note": "Pinfosys data not available" 
                    },
                     "pests": {
                        "title": "Key Pests & Diseases",
                        "value": "Oryctes & Rat Risk",
                        "note": "Oryctes in PR24 (AR Pg. 36); No Barn Owls (PA Pg. 16)"
                    },
                    "weeding": { 
                        "title": "Weeding Progress (PA)", 
                        "value": "Satisfactory", 
                        "note": "Interrow spraying complete; circle spraying delayed. (PA Pg. 11-14)" 
                    }
                },
                "keyMetrics": [
                    { 
                        "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-blue-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21v-2a4 4 0 00-4-4H9.88a4 4 0 00-3.78 2.41m-1.12-2.41a4 4 0 00-4 4v2m16-10a4 4 0 01-4 4H7a4 4 0 01-4-4' /></svg>`, 
                        "label": "Harvester Ratio", 
                        "value": "1:24 ha (Needs Improvement)" 
                    },
                    { 
                        "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg>`, 
                        "label": "P&D Status", 
                        "value": "Oryctes & Rat Risk" 
                    },
                    { 
                        "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-yellow-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z' /></svg>`, 
                        "label": "OER %", 
                        "value": "N/A" 
                    },
                    { 
                        "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-red-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 17h8m0 0V9m0 8l-8-8-4 4-6-6' /></svg>`, 
                        "label": "Harvester Prod.", 
                        "value": "1.79 MT/md (Needs Improvement)" 
                    },
                    { 
                        "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' /></svg>`, 
                        "label": "Harvest Interval", 
                        "value": "11-18 days (Acceptable)" 
                    },
                    { 
                        "icon": `<svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-teal-600' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 11c0 3.517-1.009 6.789-2.756 9.354-1.748-2.565-2.756-5.837-2.756-9.354C6.488 7.483 8.991 5 12 5s5.512 2.483 5.512 6.146c0 3.517-1.009 6.789-2.756 9.354C13.009 17.789 12 14.517 12 11z' /></svg>`, 
                        "label": "Manuring Status", 
                        "value": "In Progress" 
                    }
                ],
                "chartData": {
                    "production": {
                        "labels": ["Jun-25", "Jul-25"],
                        "ffb": [0, 2032],
                        "rainfall": [0, 0],
                        "note": "*FFB production data from Agronomy Report (June-July 2025). PA Report notes 6,798.84 MT total from 21 Jun - 30 Sep 2025. Rainfall data N/A."
                    },
                    "ageProfile": {
                        "labels": ["<3 Yrs (Immature)", "4-8 Yrs (Young Mature)", "9-12 Yrs (Young Prime)", "13-18 Yrs (Prime)", ">19 Yrs (Old Mature)"],
                        "data": [16.12, 15.71, 14.09, 3.18, 50.90],
                        "title": "Sg Pertang Palm Age Distribution (2025)",
                        "note": "*Based on Plantation Advisory Report 1/2025, pg. 6."
                    }
                },
                "observations": [
                    "<b>Harvesting Delays & Standards:</b> Harvesting standards need urgent improvement, especially for tall palms and in ravines. Intervals in Sept were 11-18 days. Crop losses observed from uncollected loose fruit and bunches on tall palms. <span class='observation-ref'>(AR Pg. 17-19; PA Pg. 24, 36)</span>",
                    "<b>Pruning Program Backlog:</b> Pruning progress remains slow, especially in old mature fields, as harvesters focus on FFB. This obstructs harvesting. <span class='observation-ref'>(AR Pg. 4, 22-23; PA Pg. 21-22, 38)</span>",
                    "<b>Labour Shortage:</b> The estate is short of 21 workers, impacting pruning progress and FFB recovery, especially in tall palm fields. Harvester ratio is 1:24 ha. <span class='observation-ref'>(PA Pg. 9, 35)</span>",
                    "<b>Weeding Quality:</b> Weeding is progressing. Interrow spraying was satisfactory (per PA). Circle spraying was delayed, but most circles are acceptable. AR had previously noted poor quality and overgrown weeds. <span class='observation-ref'>(AR Pg. 30-32; PA Pg. 12-14, 37)</span>",
                    "<b>Manuring Program Delayed:</b> The 2025 manuring program is behind schedule. Agronomy report noted delays in Urea, MOP, etc. as of July. PA report notes NK Mix application is now in progress as of October. <span class='observation-ref'>(AR Pg. 14; PA Pg. 15, 37)</span>",
                    "<b>Pest & Disease Status:</b> No barn owl boxes are installed (per PA). PA report notes no significant P&D, but AR noted low barn owl occupancy (at 40%) and Oryctes in PR24. <span class='observation-ref'>(AR Pg. 36; PA Pg. 16)</span>"
                ],
                "reports": {
                    "agronomy": { 
                        "Executive Summary": "The palm age profile is less than ideal with over half the plantings being old. Key immediate issues are significant harvesting delays, a complete lack of pruning progress since takeover, and the need to improve weeding quality. Mild nutrient deficiency symptoms were observed, and leaf sampling is planned. The 2026 fertilizer program has been drafted. <span class='observation-ref'>(AR, Pg. 4-6)</span>",
                        "Nutrient Inputs/Progress of Manuring": "The 2025 manuring program is behind schedule. As of July, only Borate application was completed. Applications for Urea, MOP, NK Mixture, and Kieserite were all delayed. A revised schedule has been advised. <span class='observation-ref'>(AR, Pg. 14-16)</span>",
                        "Agronomic Observation": "Harvesting intervals in old plantings exceed 20 days, causing over-ripe bunches and crop loss in ravines. Loose fruit collection is incomplete. No pruning has been done, leading to under-pruned conditions. Frond stacking quality is substandard. Weeding quality is poor, with overgrown weeds and over-spraying noted. <span class='observation-ref'>(AR, Pg. 17-35)</span>",
                        "Yield Performance": "Harvesting under new management began in June 2025, with July production at 2032 MT (~2mt/ha), which is considered acceptable. However, there is significant room for improvement by resolving harvesting delays, addressing the pruning backlog, and improving weeding standards. The targeted yield is 20-25 MT/ha. <span class='observation-ref'>(AR, Pg. 52-55)</span>",
                        "Fertilizer Recommendation": "The 2026 fertilizer program has been drafted for budgeting purposes and will be reviewed. It is recommended to use 600g of Controlled Release Fertilizer for new supply palms. <span class='observation-ref'>(AR, Pg. 57)</span>"
                    },
                    "plantation": { 
                        "Executive Summary": "Visit on 9th Oct 2025. FFB production (Jun-Sep) was 6,798.84 MT, 7% above estimate. However, crop losses noted from tall palms and poor loose fruit recovery. Labour is short by 21 workers. Key priorities are improving harvesting standards and accelerating pruning in old mature fields. <span class='observation-ref'>(PA Pg. 35-39)</span>",
                        "Area Statement": "Total oil palm area is 1,228.00 ha (Mature: 1,030.00 ha, Immature: 100.00 ha, Replanting: 98.00 ha). Over 50% of palms are old mature (>19 years). <span class='observation-ref'>(PA Pg. 5-6)</span>",
                        "Labour Statement": "Total 69 workers (21 estate, 48 contractor) against a requirement of 90. Harvester to land ratio is 1:24 ha. More harvesters needed for pruning and upcoming scout harvesting. <span class='observation-ref'>(PA Pg. 9)</span>",
                        "Staff Establishment": "Staffing levels are adequate. An Asst. Manager and Field Conductor were transferred to the estate in Sept 2025. <span class='observation-ref'>(PA Pg. 7)</span>",
                        "General Charges": "N/A",
                        "Upkeep and Cultivation": "Weeding: Interrow spraying satisfactory; circle spraying delayed but circles mostly clean. Manuring: NK Mix application in progress, needs expedition. P&D: No significant issues; no barn owl boxes installed. Pruning: Progress is slow, especially in old mature fields. Roads: Mostly accessible, minor repairs needed. <span class='observation-ref'>(PA Pg. 11-22)</span>",
                        "Harvesting and Collection": "Average 1.74 rounds in Sept, with intervals of 11-18 days. Standards need urgent improvement, especially for tall palms and loose fruit collection. MRS of 1 loose fruit is recommended. <span class='observation-ref'>(PA Pg. 23-27)</span>",
                        "Crop Production": "FFB from 21 Jun - 30 Sep 2025 was 6,798.84 mt (6.60 mt/ha), which was 6.93% above the estimate of 6,358.00 mt. <span class='observation-ref'>(PA Pg. 28)</span>",
                        "Production Cost": "N/A",
                        "Vehicles Running Cost": "Backhoe hours for road work, pulling tractors, etc. detailed on Pg. 20. No costs provided.",
                        "Capital Expenditure": "N/A",
                        "Immature": "PR 2023 (100 ha): Palm growth is not uniform, Rhinoceros beetle present. PR 2024 (98 ha): Palm growth is uniform and acceptable, but Rhinoceros beetle needs attention. <span class='observation-ref'>(PA Pg. 31-34)</span>"
                    },
                    "pinfosys": {
                        "CEO Financial Summary": "N/A", "Summary of Oil Palm Expenditure": "N/A"
                    }
                },
                "policy": "<p>No specific policy cross-references were available in the provided reports.</p>"
            };

            let chartInstances = {};
            const container = document.getElementById('selected-estate-container');

            function renderEstate() {
                container.innerHTML = createEstateHTML(estateData);
                setTimeout(() => {
                    initializeChartsForEstate();
                    populateInternalDropdowns();
                    attachEventListeners();
                }, 0);
            }

            function createEstateHTML(estate) {
                // --- Updated Summary Metrics HTML Generation ---
                const summaryMetricsHTML = Object.entries(estate.summaryMetrics).map(([key, metric]) => {
                    const colorClass = key === 'area' ? 'bg-blue-50 text-blue-800' :
                                       key === 'yield' ? 'bg-green-50 text-green-800' :
                                       key === 'cost' ? 'bg-orange-50 text-orange-800' :
                                       key === 'pests' ? 'bg-red-50 text-red-800' : 
                                       'bg-yellow-50 text-yellow-800'; // Default for weeding
                    
                    let contentHTML = '';
                    if (metric.lines) {
                        // For Estate Area
                        contentHTML = metric.lines.map(line => `<p class="text-sm">${line}</p>`).join('');
                    } else if (metric.value) {
                        // For Yield, Cost, Pests, Weeding
                        contentHTML = `<p class="text-2xl font-bold">${metric.value}</p>`;
                    }

                    return `<div class="p-4 rounded-lg ${colorClass}">
                                <h3 class="font-semibold">${metric.title}</h3>
                                ${contentHTML}
                                <p class="text-xs text-gray-500 mt-1">${metric.note || ''}</p>
                            </div>`;
                }).join('');
                // --- End of Updated Summary Metrics ---

                const keyMetricsHTML = estate.keyMetrics.map(metric => `
                    <div class="flex items-center space-x-3 bg-gray-50 p-3 rounded-lg">
                        <div class="bg-gray-100 p-2 rounded-full">${metric.icon}</div>
                        <div><p class="text-sm text-gray-500">${metric.label}</p><p class="font-bold text-lg">${metric.value}</p></div>
                    </div>`).join('');

                const observationsHTML = estate.observations.map(obs => `<li class="ml-4">${obs}</li>`).join('');

                return `
                    <div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold mb-2 text-gray-900">${estate.name}</h2>
                        <p class="text-sm text-gray-500 mb-6 italic">${estate.reportInfo}</p>
                        <!-- Updated Summary Grid -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-8">${summaryMetricsHTML}</div>
                        <!-- Updated Key Metrics Grid (now 2x3) -->
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-4 border-b pb-2">Key Metrics & Agronomic Status</h3><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">${keyMetricsHTML}</div></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div><h3 class="text-xl font-semibold mb-2">Monthly Production vs Rainfall</h3><div class="chart-container"><canvas id="prodChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.production.note}</p></div>
                            <div><h3 class="text-xl font-semibold mb-2">Palm Age Profile</h3><div class="pie-chart-container"><canvas id="ageChart-${estate.id}"></canvas></div><p class="text-xs text-center text-gray-500 mt-2">${estate.chartData.ageProfile.note}</p></div>
                        </div>
                        <div class="mb-8"><h3 class="text-xl font-semibold mb-2 border-b pb-2">Key Observations & Issues (Blended)</h3><ul class="list-disc list-inside space-y-2 text-gray-700 mt-4">${observationsHTML}</ul></div>
                        <div class="mb-8 text-center"><button class="policy-modal-btn bg-green-800 text-white px-6 py-3 rounded-lg hover:bg-green-900 transition shadow-md">View Agricultural Policy Cross-Reference</button></div>
                        <div class="space-y-2">
                            <button data-dropdown-id="${estate.id}-agronomy" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Agronomy Report Details (Visit: Aug 2025)</button>
                            <div id="${estate.id}-agronomy" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-plantation" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Plantation Advisory Report Details (Visit: Oct 2025)</button>
                            <div id="${estate.id}-plantation" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                            <button data-dropdown-id="${estate.id}-pinfosys" class="dropdown-btn w-full text-left bg-gray-800 text-white p-3 rounded-md hover:bg-gray-700 transition">Pinfosys Report Details</button>
                            <div id="${estate.id}-pinfosys" class="details-content bg-gray-50 p-4 rounded-md border border-gray-200"></div>
                        </div>
                    </div>`;
            }

            function initializeChartsForEstate() {
                const prodCanvasId = `prodChart-${estateData.id}`;
                const ageCanvasId = `ageChart-${estateData.id}`;
                if (chartInstances[prodCanvasId]) chartInstances[prodCanvasId].destroy();
                if (chartInstances[ageCanvasId]) chartInstances[ageCanvasId].destroy();

                const prodCtx = document.getElementById(prodCanvasId)?.getContext('2d');
                if(prodCtx) {
                    chartInstances[prodCanvasId] = new Chart(prodCtx, {
                        type: 'bar',
                        data: {
                            labels: estateData.chartData.production.labels,
                            datasets: [
                                { label: 'FFB Production (MT)', data: estateData.chartData.production.ffb, type: 'line', borderColor: '#ca8a04', backgroundColor: 'transparent', yAxisID: 'y-ffb', tension: 0.4 },
                                { label: 'Rainfall (mm)', data: estateData.chartData.production.rainfall, backgroundColor: '#3b82f6', yAxisID: 'y-rainfall' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, 'y-ffb': { type: 'linear', position: 'left', title: { display: true, text: 'FFB Production (MT)' } }, 'y-rainfall': { type: 'linear', position: 'right', title: { display: true, text: 'Rainfall (mm)' }, grid: { drawOnChartArea: false } } } }
                    });
                }

                const ageCtx = document.getElementById(ageCanvasId)?.getContext('2d');
                if(ageCtx) {
                    chartInstances[ageCanvasId] = new Chart(ageCtx, {
                        type: 'pie',
                        data: {
                            labels: estateData.chartData.ageProfile.labels,
                            datasets: [{ data: estateData.chartData.ageProfile.data, backgroundColor: ['#fde047', '#facc15', '#eab308', '#ca8a04', '#a16207'], hoverOffset: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: estateData.chartData.ageProfile.title, font: { size: 16 } }, legend: { position: 'right' } } }
                    });
                }
            }
            
            function populateInternalDropdowns() {
                const agronomyDiv = document.getElementById(`${estateData.id}-agronomy`);
                const plantationDiv = document.getElementById(`${estateData.id}-plantation`);
                const pinfosysDiv = document.getElementById(`${estateData.id}-pinfosys`);

                if (agronomyDiv && estateData.reports.agronomy) {
                    agronomyDiv.innerHTML = Object.entries(estateData.reports.agronomy).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (plantationDiv) {
                     plantationDiv.innerHTML = Object.entries(estateData.reports.plantation).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
                if (pinfosysDiv) {
                     pinfosysDiv.innerHTML = Object.entries(estateData.reports.pinfosys).map(([section, content]) => `<h4 class="font-semibold mt-2 text-gray-800">${section.replace(/([A-Z])/g, ' $1').trim()}:</h4><p class="text-sm text-gray-600">${content}</p>`).join('');
                }
            }

            function attachEventListeners() {
                container.querySelectorAll('.dropdown-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const id = event.currentTarget.dataset.dropdownId;
                        const content = document.getElementById(id);
                        content.classList.toggle('active');
                        event.currentTarget.classList.toggle('active');
                    });
                });
                container.querySelector('.policy-modal-btn')?.addEventListener('click', openPolicyModal);
            }

            renderEstate();
        });
        
        function openPolicyModal() {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const policyData = "<p>No specific policy cross-references were available in the provided reports.</p>";
            modalTitle.innerText = `Agricultural Policy Cross-Reference: Ladang Sungai Pertang`;
            modalContent.innerHTML = policyData;
            document.getElementById('policyModal').classList.add('active');
        }

        function closePolicyModal() {
            document.getElementById('policyModal').classList.remove('active');
        }
    </script>
</body>
</html>

